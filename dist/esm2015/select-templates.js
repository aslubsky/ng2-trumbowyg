// import {EventEmitter}         from '@angular/core';
const DEFAULT_ICON = 'themes/default/assets/img/t-icon.png';
export class TrumbowygSelectTemplatesPlugin {
    static init(editor, lang) {
        TrumbowygSelectTemplatesPlugin.editor = editor;
        TrumbowygSelectTemplatesPlugin.lang = lang;
        //console.log('init', editor, editor.langs, lang, editor.langs[lang].selectTemplatesNoData);
        //TrumbowygSelectResourcesPlugin.onSearch = new EventEmitter();
        editor.plugins.selectTemplates = {
            init: function (trumbowyg) {
                trumbowyg.o.plugins.selectTemplates = trumbowyg.o.plugins.selectTemplates || {};
                trumbowyg.addBtnDef('selectTemplates', {
                    fn: function (params) {
                        // console.log('selectImageCb', params, trumbowyg, editorImages);
                        TrumbowygSelectTemplatesPlugin.selectTemplatesCb(params, trumbowyg);
                    }
                });
            },
            tag: 'img'
        };
        TrumbowygSelectTemplatesPlugin.templates.push({
            id: 'tab-no-data',
            label: editor.langs[lang].selectTemplatesNoData,
            elements: []
        });
        TrumbowygSelectTemplatesPlugin.allTemplates['template-no-data'] =
            '<div>' + editor.langs[lang].selectTemplatesNoData + '</div>';
    }
    static selectTemplatesCb(params, t) {
        var pfx = t.o.prefix;
        //console.log('editorResources', editorResources);
        var html = [];
        html.push('<div class="modal-container templates-select">');
        html.push('<ul class="cbr2-tabs" role="tablist">');
        TrumbowygSelectTemplatesPlugin.templates.forEach((templateSet, i) => {
            html.push('<li role="' + templateSet.id + '" class="cbr2-tabs-item ' + (i == 0 ? 'cbr-tabs-active' : '') + '">');
            html.push('   <a data-tab="' + templateSet.id + '"  role="tab" data-toggle="tab">' + templateSet.label + '</a>');
            html.push('</li>');
        });
        html.push('</ul>');
        html.push('<div class="cbr-tab-content">');
        TrumbowygSelectTemplatesPlugin.templates.forEach((templateSet, i) => {
            html.push('   <div role="tabpanel" id="' + templateSet.id + '" class="cbr-tab-pane ' + (i == 0 ? 'active' : '') + '">');
            html.push('   <ul class="templates-list template-gallery list-unstyled">');
            templateSet.elements.forEach((template, j) => {
                template.icon = template.icon || DEFAULT_ICON;
                html.push('   <li title="' + template.description + '" class="item"><label>' +
                    '<img src="' + template.icon + '" class="select-template-icon"><input type="radio" value="' + template.id + '" name="template">' +
                    '<span class="title"> ' + template.title + '</span>' +
                    '<span class="description"> ' + template.description + '</span>' +
                    '</label></li>');
            });
            html.push('   </ul>');
            html.push('   </div>');
        });
        html.push('</div>');
        html.push('</div>');
        //console.log('html', html);
        var $modal = t.openModal(TrumbowygSelectTemplatesPlugin.editor.langs[TrumbowygSelectTemplatesPlugin.lang].selectTemplatesHeader, html.join(''))
            .on('tbwconfirm', function () {
            var selected = jQuery('input:checked', $modal);
            var val = selected.val();
            // console.log(val, allTemplates[val]);
            // jQuery(this).off(pfx + 'confirm');
            t.restoreRange();
            t.syncCode();
            if (val) {
                TrumbowygSelectTemplatesPlugin.editor.insertHtml(t, TrumbowygSelectTemplatesPlugin.allTemplates[val]);
            }
            setTimeout(function () {
                t.closeModal();
            }, 250);
        })
            .on('tbwcancel', function () {
            t.restoreRange();
            t.closeModal();
        });
        $modal.addClass('big');
        jQuery('.cbr2-tabs a', $modal).off('click').on('click', function (e) {
            e.preventDefault();
            jQuery('.cbr2-tabs-item', $modal).removeClass('cbr-tabs-active');
            jQuery(this).parent().addClass('cbr-tabs-active');
            //    console.log('O_O', $(this).attr('data-tab'));
            jQuery('.cbr-tab-content .cbr-tab-pane', $modal).removeClass('active');
            jQuery('#' + jQuery(this).attr('data-tab')).addClass('active');
        });
        jQuery('.template-gallery li label', $modal).off('click').on('click', function (e) {
            //console.log('O_O', e, $(this));
            jQuery('.template-gallery li', $modal).removeClass('active');
            jQuery(this).parent().addClass('active');
        });
    }
    static setTemplates(templates, allTemplates) {
        TrumbowygSelectTemplatesPlugin.templates = templates;
        TrumbowygSelectTemplatesPlugin.allTemplates = allTemplates;
    }
}
TrumbowygSelectTemplatesPlugin.templates = [];
TrumbowygSelectTemplatesPlugin.allTemplates = {};
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoic2VsZWN0LXRlbXBsYXRlcy5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbIi4uLy4uL3NyYy9zZWxlY3QtdGVtcGxhdGVzLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiJBQUFBLHNEQUFzRDtBQUl0RCxNQUFNLFlBQVksR0FBRyxzQ0FBc0MsQ0FBQztBQUU1RCxNQUFNLE9BQU8sOEJBQThCO0lBT2hDLE1BQU0sQ0FBQyxJQUFJLENBQUMsTUFBVyxFQUFFLElBQVk7UUFDeEMsOEJBQThCLENBQUMsTUFBTSxHQUFHLE1BQU0sQ0FBQztRQUMvQyw4QkFBOEIsQ0FBQyxJQUFJLEdBQUcsSUFBSSxDQUFDO1FBRTNDLDRGQUE0RjtRQUU1RiwrREFBK0Q7UUFFL0QsTUFBTSxDQUFDLE9BQU8sQ0FBQyxlQUFlLEdBQUc7WUFDN0IsSUFBSSxFQUFFLFVBQVUsU0FBYztnQkFDMUIsU0FBUyxDQUFDLENBQUMsQ0FBQyxPQUFPLENBQUMsZUFBZSxHQUFHLFNBQVMsQ0FBQyxDQUFDLENBQUMsT0FBTyxDQUFDLGVBQWUsSUFBSSxFQUFFLENBQUM7Z0JBQ2hGLFNBQVMsQ0FBQyxTQUFTLENBQUMsaUJBQWlCLEVBQUU7b0JBQ25DLEVBQUUsRUFBRSxVQUFVLE1BQVc7d0JBQ3JCLGlFQUFpRTt3QkFDakUsOEJBQThCLENBQUMsaUJBQWlCLENBQUMsTUFBTSxFQUFFLFNBQVMsQ0FBQyxDQUFDO29CQUN4RSxDQUFDO2lCQUNKLENBQUMsQ0FBQztZQUNQLENBQUM7WUFDRCxHQUFHLEVBQUUsS0FBSztTQUNiLENBQUE7UUFHRCw4QkFBOEIsQ0FBQyxTQUFTLENBQUMsSUFBSSxDQUFDO1lBQzFDLEVBQUUsRUFBRSxhQUFhO1lBQ2pCLEtBQUssRUFBRSxNQUFNLENBQUMsS0FBSyxDQUFDLElBQUksQ0FBQyxDQUFDLHFCQUFxQjtZQUMvQyxRQUFRLEVBQUUsRUFBRTtTQUNmLENBQUMsQ0FBQztRQUNILDhCQUE4QixDQUFDLFlBQVksQ0FBQyxrQkFBa0IsQ0FBQztZQUMzRCxPQUFPLEdBQUcsTUFBTSxDQUFDLEtBQUssQ0FBQyxJQUFJLENBQUMsQ0FBQyxxQkFBcUIsR0FBRyxRQUFRLENBQUM7SUFDdEUsQ0FBQztJQUVPLE1BQU0sQ0FBQyxpQkFBaUIsQ0FBQyxNQUFXLEVBQUUsQ0FBTTtRQUNoRCxJQUFJLEdBQUcsR0FBVyxDQUFDLENBQUMsQ0FBQyxDQUFDLE1BQU0sQ0FBQztRQUM3QixrREFBa0Q7UUFFbEQsSUFBSSxJQUFJLEdBQWEsRUFBRSxDQUFDO1FBRXhCLElBQUksQ0FBQyxJQUFJLENBQUMsZ0RBQWdELENBQUMsQ0FBQztRQUM1RCxJQUFJLENBQUMsSUFBSSxDQUFDLHVDQUF1QyxDQUFDLENBQUM7UUFDbkQsOEJBQThCLENBQUMsU0FBUyxDQUFDLE9BQU8sQ0FBQyxDQUFDLFdBQVcsRUFBRSxDQUFDLEVBQUUsRUFBRTtZQUNoRSxJQUFJLENBQUMsSUFBSSxDQUFDLFlBQVksR0FBRyxXQUFXLENBQUMsRUFBRSxHQUFHLDBCQUEwQixHQUFHLENBQUMsQ0FBQyxJQUFJLENBQUMsQ0FBQyxDQUFDLENBQUMsaUJBQWlCLENBQUMsQ0FBQyxDQUFDLEVBQUUsQ0FBQyxHQUFHLElBQUksQ0FBQyxDQUFDO1lBQ2pILElBQUksQ0FBQyxJQUFJLENBQUMsa0JBQWtCLEdBQUcsV0FBVyxDQUFDLEVBQUUsR0FBRyxrQ0FBa0MsR0FBRyxXQUFXLENBQUMsS0FBSyxHQUFHLE1BQU0sQ0FBQyxDQUFDO1lBQ2pILElBQUksQ0FBQyxJQUFJLENBQUMsT0FBTyxDQUFDLENBQUM7UUFDdkIsQ0FBQyxDQUFDLENBQUM7UUFFSCxJQUFJLENBQUMsSUFBSSxDQUFDLE9BQU8sQ0FBQyxDQUFDO1FBQ25CLElBQUksQ0FBQyxJQUFJLENBQUMsK0JBQStCLENBQUMsQ0FBQztRQUczQyw4QkFBOEIsQ0FBQyxTQUFTLENBQUMsT0FBTyxDQUFDLENBQUMsV0FBVyxFQUFFLENBQUMsRUFBRSxFQUFFO1lBQ2hFLElBQUksQ0FBQyxJQUFJLENBQUMsOEJBQThCLEdBQUcsV0FBVyxDQUFDLEVBQUUsR0FBRyx3QkFBd0IsR0FBRyxDQUFDLENBQUMsSUFBSSxDQUFDLENBQUMsQ0FBQyxDQUFDLFFBQVEsQ0FBQyxDQUFDLENBQUMsRUFBRSxDQUFDLEdBQUcsSUFBSSxDQUFDLENBQUM7WUFDeEgsSUFBSSxDQUFDLElBQUksQ0FBQywrREFBK0QsQ0FBQyxDQUFDO1lBQzNFLFdBQVcsQ0FBQyxRQUFRLENBQUMsT0FBTyxDQUFDLENBQUMsUUFBYSxFQUFFLENBQVMsRUFBRSxFQUFFO2dCQUN0RCxRQUFRLENBQUMsSUFBSSxHQUFHLFFBQVEsQ0FBQyxJQUFJLElBQUksWUFBWSxDQUFDO2dCQUM5QyxJQUFJLENBQUMsSUFBSSxDQUFDLGdCQUFnQixHQUFHLFFBQVEsQ0FBQyxXQUFXLEdBQUcsd0JBQXdCO29CQUN4RSxZQUFZLEdBQUcsUUFBUSxDQUFDLElBQUksR0FBRyw0REFBNEQsR0FBRyxRQUFRLENBQUMsRUFBRSxHQUFHLG9CQUFvQjtvQkFDaEksdUJBQXVCLEdBQUcsUUFBUSxDQUFDLEtBQUssR0FBRyxTQUFTO29CQUNwRCw2QkFBNkIsR0FBRyxRQUFRLENBQUMsV0FBVyxHQUFHLFNBQVM7b0JBQ2hFLGVBQWUsQ0FBQyxDQUFDO1lBQ3pCLENBQUMsQ0FBQyxDQUFDO1lBQ0gsSUFBSSxDQUFDLElBQUksQ0FBQyxVQUFVLENBQUMsQ0FBQztZQUN0QixJQUFJLENBQUMsSUFBSSxDQUFDLFdBQVcsQ0FBQyxDQUFDO1FBQzNCLENBQUMsQ0FBQyxDQUFDO1FBRUgsSUFBSSxDQUFDLElBQUksQ0FBQyxRQUFRLENBQUMsQ0FBQztRQUNwQixJQUFJLENBQUMsSUFBSSxDQUFDLFFBQVEsQ0FBQyxDQUFDO1FBR3BCLDRCQUE0QjtRQUM1QixJQUFJLE1BQU0sR0FBRyxDQUFDLENBQUMsU0FBUyxDQUFDLDhCQUE4QixDQUFDLE1BQU0sQ0FBQyxLQUFLLENBQUMsOEJBQThCLENBQUMsSUFBSSxDQUFDLENBQUMscUJBQXFCLEVBQUUsSUFBSSxDQUFDLElBQUksQ0FBQyxFQUFFLENBQUMsQ0FBQzthQUMxSSxFQUFFLENBQUMsWUFBWSxFQUFFO1lBQ2QsSUFBSSxRQUFRLEdBQUcsTUFBTSxDQUFDLGVBQWUsRUFBRSxNQUFNLENBQUMsQ0FBQztZQUMvQyxJQUFJLEdBQUcsR0FBRyxRQUFRLENBQUMsR0FBRyxFQUFFLENBQUM7WUFDekIsdUNBQXVDO1lBQ3ZDLHFDQUFxQztZQUVyQyxDQUFDLENBQUMsWUFBWSxFQUFFLENBQUM7WUFDakIsQ0FBQyxDQUFDLFFBQVEsRUFBRSxDQUFDO1lBRWIsSUFBSSxHQUFHLEVBQUU7Z0JBQ0wsOEJBQThCLENBQUMsTUFBTSxDQUFDLFVBQVUsQ0FBQyxDQUFDLEVBQUUsOEJBQThCLENBQUMsWUFBWSxDQUFDLEdBQUcsQ0FBQyxDQUFDLENBQUM7YUFDekc7WUFFRCxVQUFVLENBQUM7Z0JBQ1AsQ0FBQyxDQUFDLFVBQVUsRUFBRSxDQUFDO1lBQ25CLENBQUMsRUFBRSxHQUFHLENBQUMsQ0FBQztRQUNaLENBQUMsQ0FBQzthQUNELEVBQUUsQ0FBQyxXQUFXLEVBQUU7WUFDYixDQUFDLENBQUMsWUFBWSxFQUFFLENBQUM7WUFDakIsQ0FBQyxDQUFDLFVBQVUsRUFBRSxDQUFDO1FBQ25CLENBQUMsQ0FBQyxDQUFDO1FBQ1AsTUFBTSxDQUFDLFFBQVEsQ0FBQyxLQUFLLENBQUMsQ0FBQztRQUV2QixNQUFNLENBQUMsY0FBYyxFQUFFLE1BQU0sQ0FBQyxDQUFDLEdBQUcsQ0FBQyxPQUFPLENBQUMsQ0FBQyxFQUFFLENBQUMsT0FBTyxFQUFFLFVBQVUsQ0FBTTtZQUNwRSxDQUFDLENBQUMsY0FBYyxFQUFFLENBQUM7WUFFbkIsTUFBTSxDQUFDLGlCQUFpQixFQUFFLE1BQU0sQ0FBQyxDQUFDLFdBQVcsQ0FBQyxpQkFBaUIsQ0FBQyxDQUFDO1lBQ2pFLE1BQU0sQ0FBQyxJQUFJLENBQUMsQ0FBQyxNQUFNLEVBQUUsQ0FBQyxRQUFRLENBQUMsaUJBQWlCLENBQUMsQ0FBQztZQUVsRCxtREFBbUQ7WUFDbkQsTUFBTSxDQUFDLGdDQUFnQyxFQUFFLE1BQU0sQ0FBQyxDQUFDLFdBQVcsQ0FBQyxRQUFRLENBQUMsQ0FBQztZQUN2RSxNQUFNLENBQUMsR0FBRyxHQUFHLE1BQU0sQ0FBQyxJQUFJLENBQUMsQ0FBQyxJQUFJLENBQUMsVUFBVSxDQUFDLENBQUMsQ0FBQyxRQUFRLENBQUMsUUFBUSxDQUFDLENBQUM7UUFDbkUsQ0FBQyxDQUFDLENBQUM7UUFDSCxNQUFNLENBQUMsNEJBQTRCLEVBQUUsTUFBTSxDQUFDLENBQUMsR0FBRyxDQUFDLE9BQU8sQ0FBQyxDQUFDLEVBQUUsQ0FBQyxPQUFPLEVBQUUsVUFBVSxDQUFNO1lBQ2xGLGlDQUFpQztZQUNqQyxNQUFNLENBQUMsc0JBQXNCLEVBQUUsTUFBTSxDQUFDLENBQUMsV0FBVyxDQUFDLFFBQVEsQ0FBQyxDQUFDO1lBQzdELE1BQU0sQ0FBQyxJQUFJLENBQUMsQ0FBQyxNQUFNLEVBQUUsQ0FBQyxRQUFRLENBQUMsUUFBUSxDQUFDLENBQUM7UUFDN0MsQ0FBQyxDQUFDLENBQUM7SUFDUCxDQUFDO0lBRU0sTUFBTSxDQUFDLFlBQVksQ0FBQyxTQUFnQixFQUFFLFlBQWlCO1FBQzFELDhCQUE4QixDQUFDLFNBQVMsR0FBRyxTQUFTLENBQUM7UUFDckQsOEJBQThCLENBQUMsWUFBWSxHQUFHLFlBQVksQ0FBQztJQUMvRCxDQUFDOztBQXZIYSx3Q0FBUyxHQUFVLEVBQUUsQ0FBQztBQUN0QiwyQ0FBWSxHQUFRLEVBQUUsQ0FBQyIsInNvdXJjZXNDb250ZW50IjpbIi8vIGltcG9ydCB7RXZlbnRFbWl0dGVyfSAgICAgICAgIGZyb20gJ0Bhbmd1bGFyL2NvcmUnO1xuXG5kZWNsYXJlIHZhciBqUXVlcnk6IGFueTtcblxuY29uc3QgREVGQVVMVF9JQ09OID0gJ3RoZW1lcy9kZWZhdWx0L2Fzc2V0cy9pbWcvdC1pY29uLnBuZyc7XG5cbmV4cG9ydCBjbGFzcyBUcnVtYm93eWdTZWxlY3RUZW1wbGF0ZXNQbHVnaW4ge1xuICAgIHB1YmxpYyBzdGF0aWMgdGVtcGxhdGVzOiBhbnlbXSA9IFtdO1xuICAgIHB1YmxpYyBzdGF0aWMgYWxsVGVtcGxhdGVzOiBhbnkgPSB7fTtcblxuICAgIHB1YmxpYyBzdGF0aWMgZWRpdG9yOiBhbnk7XG4gICAgcHVibGljIHN0YXRpYyBsYW5nOiBzdHJpbmc7XG5cbiAgICBwdWJsaWMgc3RhdGljIGluaXQoZWRpdG9yOiBhbnksIGxhbmc6IHN0cmluZykge1xuICAgICAgICBUcnVtYm93eWdTZWxlY3RUZW1wbGF0ZXNQbHVnaW4uZWRpdG9yID0gZWRpdG9yO1xuICAgICAgICBUcnVtYm93eWdTZWxlY3RUZW1wbGF0ZXNQbHVnaW4ubGFuZyA9IGxhbmc7XG5cbiAgICAgICAgLy9jb25zb2xlLmxvZygnaW5pdCcsIGVkaXRvciwgZWRpdG9yLmxhbmdzLCBsYW5nLCBlZGl0b3IubGFuZ3NbbGFuZ10uc2VsZWN0VGVtcGxhdGVzTm9EYXRhKTtcblxuICAgICAgICAvL1RydW1ib3d5Z1NlbGVjdFJlc291cmNlc1BsdWdpbi5vblNlYXJjaCA9IG5ldyBFdmVudEVtaXR0ZXIoKTtcblxuICAgICAgICBlZGl0b3IucGx1Z2lucy5zZWxlY3RUZW1wbGF0ZXMgPSB7XG4gICAgICAgICAgICBpbml0OiBmdW5jdGlvbiAodHJ1bWJvd3lnOiBhbnkpIHtcbiAgICAgICAgICAgICAgICB0cnVtYm93eWcuby5wbHVnaW5zLnNlbGVjdFRlbXBsYXRlcyA9IHRydW1ib3d5Zy5vLnBsdWdpbnMuc2VsZWN0VGVtcGxhdGVzIHx8IHt9O1xuICAgICAgICAgICAgICAgIHRydW1ib3d5Zy5hZGRCdG5EZWYoJ3NlbGVjdFRlbXBsYXRlcycsIHtcbiAgICAgICAgICAgICAgICAgICAgZm46IGZ1bmN0aW9uIChwYXJhbXM6IGFueSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgLy8gY29uc29sZS5sb2coJ3NlbGVjdEltYWdlQ2InLCBwYXJhbXMsIHRydW1ib3d5ZywgZWRpdG9ySW1hZ2VzKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIFRydW1ib3d5Z1NlbGVjdFRlbXBsYXRlc1BsdWdpbi5zZWxlY3RUZW1wbGF0ZXNDYihwYXJhbXMsIHRydW1ib3d5Zyk7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICB0YWc6ICdpbWcnXG4gICAgICAgIH1cblxuXG4gICAgICAgIFRydW1ib3d5Z1NlbGVjdFRlbXBsYXRlc1BsdWdpbi50ZW1wbGF0ZXMucHVzaCh7XG4gICAgICAgICAgICBpZDogJ3RhYi1uby1kYXRhJyxcbiAgICAgICAgICAgIGxhYmVsOiBlZGl0b3IubGFuZ3NbbGFuZ10uc2VsZWN0VGVtcGxhdGVzTm9EYXRhLFxuICAgICAgICAgICAgZWxlbWVudHM6IFtdXG4gICAgICAgIH0pO1xuICAgICAgICBUcnVtYm93eWdTZWxlY3RUZW1wbGF0ZXNQbHVnaW4uYWxsVGVtcGxhdGVzWyd0ZW1wbGF0ZS1uby1kYXRhJ10gPVxuICAgICAgICAgICAgJzxkaXY+JyArIGVkaXRvci5sYW5nc1tsYW5nXS5zZWxlY3RUZW1wbGF0ZXNOb0RhdGEgKyAnPC9kaXY+JztcbiAgICB9XG5cbiAgICBwcml2YXRlIHN0YXRpYyBzZWxlY3RUZW1wbGF0ZXNDYihwYXJhbXM6IGFueSwgdDogYW55KSB7XG4gICAgICAgIHZhciBwZng6IHN0cmluZyA9IHQuby5wcmVmaXg7XG4gICAgICAgIC8vY29uc29sZS5sb2coJ2VkaXRvclJlc291cmNlcycsIGVkaXRvclJlc291cmNlcyk7XG5cbiAgICAgICAgdmFyIGh0bWw6IHN0cmluZ1tdID0gW107XG5cbiAgICAgICAgaHRtbC5wdXNoKCc8ZGl2IGNsYXNzPVwibW9kYWwtY29udGFpbmVyIHRlbXBsYXRlcy1zZWxlY3RcIj4nKTtcbiAgICAgICAgaHRtbC5wdXNoKCc8dWwgY2xhc3M9XCJjYnIyLXRhYnNcIiByb2xlPVwidGFibGlzdFwiPicpO1xuICAgICAgICBUcnVtYm93eWdTZWxlY3RUZW1wbGF0ZXNQbHVnaW4udGVtcGxhdGVzLmZvckVhY2goKHRlbXBsYXRlU2V0LCBpKSA9PiB7XG4gICAgICAgICAgICBodG1sLnB1c2goJzxsaSByb2xlPVwiJyArIHRlbXBsYXRlU2V0LmlkICsgJ1wiIGNsYXNzPVwiY2JyMi10YWJzLWl0ZW0gJyArIChpID09IDAgPyAnY2JyLXRhYnMtYWN0aXZlJyA6ICcnKSArICdcIj4nKTtcbiAgICAgICAgICAgIGh0bWwucHVzaCgnICAgPGEgZGF0YS10YWI9XCInICsgdGVtcGxhdGVTZXQuaWQgKyAnXCIgIHJvbGU9XCJ0YWJcIiBkYXRhLXRvZ2dsZT1cInRhYlwiPicgKyB0ZW1wbGF0ZVNldC5sYWJlbCArICc8L2E+Jyk7XG4gICAgICAgICAgICBodG1sLnB1c2goJzwvbGk+Jyk7XG4gICAgICAgIH0pO1xuXG4gICAgICAgIGh0bWwucHVzaCgnPC91bD4nKTtcbiAgICAgICAgaHRtbC5wdXNoKCc8ZGl2IGNsYXNzPVwiY2JyLXRhYi1jb250ZW50XCI+Jyk7XG5cblxuICAgICAgICBUcnVtYm93eWdTZWxlY3RUZW1wbGF0ZXNQbHVnaW4udGVtcGxhdGVzLmZvckVhY2goKHRlbXBsYXRlU2V0LCBpKSA9PiB7XG4gICAgICAgICAgICBodG1sLnB1c2goJyAgIDxkaXYgcm9sZT1cInRhYnBhbmVsXCIgaWQ9XCInICsgdGVtcGxhdGVTZXQuaWQgKyAnXCIgY2xhc3M9XCJjYnItdGFiLXBhbmUgJyArIChpID09IDAgPyAnYWN0aXZlJyA6ICcnKSArICdcIj4nKTtcbiAgICAgICAgICAgIGh0bWwucHVzaCgnICAgPHVsIGNsYXNzPVwidGVtcGxhdGVzLWxpc3QgdGVtcGxhdGUtZ2FsbGVyeSBsaXN0LXVuc3R5bGVkXCI+Jyk7XG4gICAgICAgICAgICB0ZW1wbGF0ZVNldC5lbGVtZW50cy5mb3JFYWNoKCh0ZW1wbGF0ZTogYW55LCBqOiBudW1iZXIpID0+IHtcbiAgICAgICAgICAgICAgICB0ZW1wbGF0ZS5pY29uID0gdGVtcGxhdGUuaWNvbiB8fCBERUZBVUxUX0lDT047XG4gICAgICAgICAgICAgICAgaHRtbC5wdXNoKCcgICA8bGkgdGl0bGU9XCInICsgdGVtcGxhdGUuZGVzY3JpcHRpb24gKyAnXCIgY2xhc3M9XCJpdGVtXCI+PGxhYmVsPicgK1xuICAgICAgICAgICAgICAgICAgICAnPGltZyBzcmM9XCInICsgdGVtcGxhdGUuaWNvbiArICdcIiBjbGFzcz1cInNlbGVjdC10ZW1wbGF0ZS1pY29uXCI+PGlucHV0IHR5cGU9XCJyYWRpb1wiIHZhbHVlPVwiJyArIHRlbXBsYXRlLmlkICsgJ1wiIG5hbWU9XCJ0ZW1wbGF0ZVwiPicgK1xuICAgICAgICAgICAgICAgICAgICAnPHNwYW4gY2xhc3M9XCJ0aXRsZVwiPiAnICsgdGVtcGxhdGUudGl0bGUgKyAnPC9zcGFuPicgK1xuICAgICAgICAgICAgICAgICAgICAnPHNwYW4gY2xhc3M9XCJkZXNjcmlwdGlvblwiPiAnICsgdGVtcGxhdGUuZGVzY3JpcHRpb24gKyAnPC9zcGFuPicgK1xuICAgICAgICAgICAgICAgICAgICAnPC9sYWJlbD48L2xpPicpO1xuICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICBodG1sLnB1c2goJyAgIDwvdWw+Jyk7XG4gICAgICAgICAgICBodG1sLnB1c2goJyAgIDwvZGl2PicpO1xuICAgICAgICB9KTtcblxuICAgICAgICBodG1sLnB1c2goJzwvZGl2PicpO1xuICAgICAgICBodG1sLnB1c2goJzwvZGl2PicpO1xuXG5cbiAgICAgICAgLy9jb25zb2xlLmxvZygnaHRtbCcsIGh0bWwpO1xuICAgICAgICB2YXIgJG1vZGFsID0gdC5vcGVuTW9kYWwoVHJ1bWJvd3lnU2VsZWN0VGVtcGxhdGVzUGx1Z2luLmVkaXRvci5sYW5nc1tUcnVtYm93eWdTZWxlY3RUZW1wbGF0ZXNQbHVnaW4ubGFuZ10uc2VsZWN0VGVtcGxhdGVzSGVhZGVyLCBodG1sLmpvaW4oJycpKVxuICAgICAgICAgICAgLm9uKCd0Yndjb25maXJtJywgZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgICAgIHZhciBzZWxlY3RlZCA9IGpRdWVyeSgnaW5wdXQ6Y2hlY2tlZCcsICRtb2RhbCk7XG4gICAgICAgICAgICAgICAgdmFyIHZhbCA9IHNlbGVjdGVkLnZhbCgpO1xuICAgICAgICAgICAgICAgIC8vIGNvbnNvbGUubG9nKHZhbCwgYWxsVGVtcGxhdGVzW3ZhbF0pO1xuICAgICAgICAgICAgICAgIC8vIGpRdWVyeSh0aGlzKS5vZmYocGZ4ICsgJ2NvbmZpcm0nKTtcblxuICAgICAgICAgICAgICAgIHQucmVzdG9yZVJhbmdlKCk7XG4gICAgICAgICAgICAgICAgdC5zeW5jQ29kZSgpO1xuXG4gICAgICAgICAgICAgICAgaWYgKHZhbCkge1xuICAgICAgICAgICAgICAgICAgICBUcnVtYm93eWdTZWxlY3RUZW1wbGF0ZXNQbHVnaW4uZWRpdG9yLmluc2VydEh0bWwodCwgVHJ1bWJvd3lnU2VsZWN0VGVtcGxhdGVzUGx1Z2luLmFsbFRlbXBsYXRlc1t2YWxdKTtcbiAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICBzZXRUaW1lb3V0KGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgICAgICAgICAgdC5jbG9zZU1vZGFsKCk7XG4gICAgICAgICAgICAgICAgfSwgMjUwKTtcbiAgICAgICAgICAgIH0pXG4gICAgICAgICAgICAub24oJ3Rid2NhbmNlbCcsIGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgICAgICB0LnJlc3RvcmVSYW5nZSgpO1xuICAgICAgICAgICAgICAgIHQuY2xvc2VNb2RhbCgpO1xuICAgICAgICAgICAgfSk7XG4gICAgICAgICRtb2RhbC5hZGRDbGFzcygnYmlnJyk7XG5cbiAgICAgICAgalF1ZXJ5KCcuY2JyMi10YWJzIGEnLCAkbW9kYWwpLm9mZignY2xpY2snKS5vbignY2xpY2snLCBmdW5jdGlvbiAoZTogYW55KSB7XG4gICAgICAgICAgICBlLnByZXZlbnREZWZhdWx0KCk7XG5cbiAgICAgICAgICAgIGpRdWVyeSgnLmNicjItdGFicy1pdGVtJywgJG1vZGFsKS5yZW1vdmVDbGFzcygnY2JyLXRhYnMtYWN0aXZlJyk7XG4gICAgICAgICAgICBqUXVlcnkodGhpcykucGFyZW50KCkuYWRkQ2xhc3MoJ2Nici10YWJzLWFjdGl2ZScpO1xuXG4gICAgICAgICAgICAvLyAgICBjb25zb2xlLmxvZygnT19PJywgJCh0aGlzKS5hdHRyKCdkYXRhLXRhYicpKTtcbiAgICAgICAgICAgIGpRdWVyeSgnLmNici10YWItY29udGVudCAuY2JyLXRhYi1wYW5lJywgJG1vZGFsKS5yZW1vdmVDbGFzcygnYWN0aXZlJyk7XG4gICAgICAgICAgICBqUXVlcnkoJyMnICsgalF1ZXJ5KHRoaXMpLmF0dHIoJ2RhdGEtdGFiJykpLmFkZENsYXNzKCdhY3RpdmUnKTtcbiAgICAgICAgfSk7XG4gICAgICAgIGpRdWVyeSgnLnRlbXBsYXRlLWdhbGxlcnkgbGkgbGFiZWwnLCAkbW9kYWwpLm9mZignY2xpY2snKS5vbignY2xpY2snLCBmdW5jdGlvbiAoZTogYW55KSB7XG4gICAgICAgICAgICAvL2NvbnNvbGUubG9nKCdPX08nLCBlLCAkKHRoaXMpKTtcbiAgICAgICAgICAgIGpRdWVyeSgnLnRlbXBsYXRlLWdhbGxlcnkgbGknLCAkbW9kYWwpLnJlbW92ZUNsYXNzKCdhY3RpdmUnKTtcbiAgICAgICAgICAgIGpRdWVyeSh0aGlzKS5wYXJlbnQoKS5hZGRDbGFzcygnYWN0aXZlJyk7XG4gICAgICAgIH0pO1xuICAgIH1cblxuICAgIHB1YmxpYyBzdGF0aWMgc2V0VGVtcGxhdGVzKHRlbXBsYXRlczogYW55W10sIGFsbFRlbXBsYXRlczogYW55KSB7XG4gICAgICAgIFRydW1ib3d5Z1NlbGVjdFRlbXBsYXRlc1BsdWdpbi50ZW1wbGF0ZXMgPSB0ZW1wbGF0ZXM7XG4gICAgICAgIFRydW1ib3d5Z1NlbGVjdFRlbXBsYXRlc1BsdWdpbi5hbGxUZW1wbGF0ZXMgPSBhbGxUZW1wbGF0ZXM7XG4gICAgfVxufVxuIl19