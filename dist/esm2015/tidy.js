import 'rxjs/add/operator/toPromise';
export class TrumbowygTidyPlugin {
    static init(editor, lang, http) {
        TrumbowygTidyPlugin.editor = editor;
        editor.plugins.tidy = {
            init: (t) => {
                // console.log('TrumbowygCodemirrorPlugin');
                t.toggle = () => {
                    var prefix = t.o.prefix;
                    t.semanticCode(false, true);
                    setTimeout(function () {
                        t.doc.activeElement.blur();
                        t.$box.toggleClass(prefix + 'editor-hidden ' + prefix + 'editor-visible');
                        t.$btnPane.toggleClass(prefix + 'disable');
                        t.$btnPane.find('.' + prefix + 'viewHTML-button').toggleClass(prefix + 'active');
                        if (t.$box.hasClass(prefix + 'editor-visible')) {
                            t.$ta.attr('tabindex', -1);
                        }
                        else {
                            if (TrumbowygTidyPlugin.editor.tidyUrl) {
                                // console.log(t.$ed.html());
                                http.post(TrumbowygTidyPlugin.editor.tidyUrl, t.$ed.html(), {
                                    responseType: 'text'
                                })
                                    .toPromise()
                                    .then((res) => {
                                    // console.log('tidy res', res.text());
                                    t.$ta.val(res);
                                });
                            }
                            t.$ta.removeAttr('tabindex');
                        }
                    }, 0);
                };
            }
        };
    }
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoidGlkeS5qcyIsInNvdXJjZVJvb3QiOiIvaG9tZS9hc2x1YnNreS93b3JrL2NvbGxhYm9yYXRvci9uZzItdHJ1bWJvd3lnL3NyYy8iLCJzb3VyY2VzIjpbInRpZHkudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IkFBQ0EsT0FBTyw2QkFBNkIsQ0FBQztBQUVyQyxNQUFNLE9BQU8sbUJBQW1CO0lBR3JCLE1BQU0sQ0FBQyxJQUFJLENBQUMsTUFBVyxFQUFFLElBQVksRUFBRSxJQUFnQjtRQUMxRCxtQkFBbUIsQ0FBQyxNQUFNLEdBQUcsTUFBTSxDQUFDO1FBRXBDLE1BQU0sQ0FBQyxPQUFPLENBQUMsSUFBSSxHQUFHO1lBQ2xCLElBQUksRUFBRSxDQUFDLENBQU0sRUFBRSxFQUFFO2dCQUNiLDRDQUE0QztnQkFFNUMsQ0FBQyxDQUFDLE1BQU0sR0FBRyxHQUFHLEVBQUU7b0JBQ1osSUFBSSxNQUFNLEdBQUcsQ0FBQyxDQUFDLENBQUMsQ0FBQyxNQUFNLENBQUM7b0JBQ3hCLENBQUMsQ0FBQyxZQUFZLENBQUMsS0FBSyxFQUFFLElBQUksQ0FBQyxDQUFDO29CQUM1QixVQUFVLENBQUM7d0JBQ1AsQ0FBQyxDQUFDLEdBQUcsQ0FBQyxhQUFhLENBQUMsSUFBSSxFQUFFLENBQUM7d0JBQzNCLENBQUMsQ0FBQyxJQUFJLENBQUMsV0FBVyxDQUFDLE1BQU0sR0FBRyxnQkFBZ0IsR0FBRyxNQUFNLEdBQUcsZ0JBQWdCLENBQUMsQ0FBQzt3QkFDMUUsQ0FBQyxDQUFDLFFBQVEsQ0FBQyxXQUFXLENBQUMsTUFBTSxHQUFHLFNBQVMsQ0FBQyxDQUFDO3dCQUMzQyxDQUFDLENBQUMsUUFBUSxDQUFDLElBQUksQ0FBQyxHQUFHLEdBQUcsTUFBTSxHQUFHLGlCQUFpQixDQUFDLENBQUMsV0FBVyxDQUFDLE1BQU0sR0FBRyxRQUFRLENBQUMsQ0FBQzt3QkFDakYsSUFBSSxDQUFDLENBQUMsSUFBSSxDQUFDLFFBQVEsQ0FBQyxNQUFNLEdBQUcsZ0JBQWdCLENBQUMsRUFBRTs0QkFDNUMsQ0FBQyxDQUFDLEdBQUcsQ0FBQyxJQUFJLENBQUMsVUFBVSxFQUFFLENBQUMsQ0FBQyxDQUFDLENBQUM7eUJBQzlCOzZCQUFNOzRCQUNILElBQUksbUJBQW1CLENBQUMsTUFBTSxDQUFDLE9BQU8sRUFBRTtnQ0FDcEMsNkJBQTZCO2dDQUM3QixJQUFJLENBQUMsSUFBSSxDQUNMLG1CQUFtQixDQUFDLE1BQU0sQ0FBQyxPQUFPLEVBQ2xDLENBQUMsQ0FBQyxHQUFHLENBQUMsSUFBSSxFQUFFLEVBQUU7b0NBQ1YsWUFBWSxFQUFFLE1BQU07aUNBQ3ZCLENBQUM7cUNBQ0QsU0FBUyxFQUFFO3FDQUNYLElBQUksQ0FBQyxDQUFDLEdBQVEsRUFBRSxFQUFFO29DQUNmLHVDQUF1QztvQ0FDdkMsQ0FBQyxDQUFDLEdBQUcsQ0FBQyxHQUFHLENBQUMsR0FBRyxDQUFDLENBQUM7Z0NBQ25CLENBQUMsQ0FBQyxDQUFDOzZCQUNWOzRCQUNELENBQUMsQ0FBQyxHQUFHLENBQUMsVUFBVSxDQUFDLFVBQVUsQ0FBQyxDQUFDO3lCQUNoQztvQkFDTCxDQUFDLEVBQUUsQ0FBQyxDQUFDLENBQUM7Z0JBQ1YsQ0FBQyxDQUFDO1lBQ04sQ0FBQztTQUNKLENBQUE7SUFDTCxDQUFDO0NBQ0oiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQge0h0dHBDbGllbnR9IGZyb20gJ0Bhbmd1bGFyL2NvbW1vbi9odHRwJztcbmltcG9ydCAncnhqcy9hZGQvb3BlcmF0b3IvdG9Qcm9taXNlJztcblxuZXhwb3J0IGNsYXNzIFRydW1ib3d5Z1RpZHlQbHVnaW4ge1xuICAgIHB1YmxpYyBzdGF0aWMgZWRpdG9yOiBhbnk7XG5cbiAgICBwdWJsaWMgc3RhdGljIGluaXQoZWRpdG9yOiBhbnksIGxhbmc6IHN0cmluZywgaHR0cDogSHR0cENsaWVudCkge1xuICAgICAgICBUcnVtYm93eWdUaWR5UGx1Z2luLmVkaXRvciA9IGVkaXRvcjtcblxuICAgICAgICBlZGl0b3IucGx1Z2lucy50aWR5ID0ge1xuICAgICAgICAgICAgaW5pdDogKHQ6IGFueSkgPT4ge1xuICAgICAgICAgICAgICAgIC8vIGNvbnNvbGUubG9nKCdUcnVtYm93eWdDb2RlbWlycm9yUGx1Z2luJyk7XG5cbiAgICAgICAgICAgICAgICB0LnRvZ2dsZSA9ICgpID0+IHtcbiAgICAgICAgICAgICAgICAgICAgdmFyIHByZWZpeCA9IHQuby5wcmVmaXg7XG4gICAgICAgICAgICAgICAgICAgIHQuc2VtYW50aWNDb2RlKGZhbHNlLCB0cnVlKTtcbiAgICAgICAgICAgICAgICAgICAgc2V0VGltZW91dChmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICB0LmRvYy5hY3RpdmVFbGVtZW50LmJsdXIoKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIHQuJGJveC50b2dnbGVDbGFzcyhwcmVmaXggKyAnZWRpdG9yLWhpZGRlbiAnICsgcHJlZml4ICsgJ2VkaXRvci12aXNpYmxlJyk7XG4gICAgICAgICAgICAgICAgICAgICAgICB0LiRidG5QYW5lLnRvZ2dsZUNsYXNzKHByZWZpeCArICdkaXNhYmxlJyk7XG4gICAgICAgICAgICAgICAgICAgICAgICB0LiRidG5QYW5lLmZpbmQoJy4nICsgcHJlZml4ICsgJ3ZpZXdIVE1MLWJ1dHRvbicpLnRvZ2dsZUNsYXNzKHByZWZpeCArICdhY3RpdmUnKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmICh0LiRib3guaGFzQ2xhc3MocHJlZml4ICsgJ2VkaXRvci12aXNpYmxlJykpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0LiR0YS5hdHRyKCd0YWJpbmRleCcsIC0xKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKFRydW1ib3d5Z1RpZHlQbHVnaW4uZWRpdG9yLnRpZHlVcmwpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8gY29uc29sZS5sb2codC4kZWQuaHRtbCgpKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaHR0cC5wb3N0KFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgVHJ1bWJvd3lnVGlkeVBsdWdpbi5lZGl0b3IudGlkeVVybCxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHQuJGVkLmh0bWwoKSwge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJlc3BvbnNlVHlwZTogJ3RleHQnXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9KVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLnRvUHJvbWlzZSgpXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAudGhlbigocmVzOiBhbnkpID0+IHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAvLyBjb25zb2xlLmxvZygndGlkeSByZXMnLCByZXMudGV4dCgpKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0LiR0YS52YWwocmVzKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0LiR0YS5yZW1vdmVBdHRyKCd0YWJpbmRleCcpO1xuICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICB9LCAwKTtcbiAgICAgICAgICAgICAgICB9O1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgfVxufVxuIl19