export class TrumbowygTidyPlugin {
    static init(editor, lang, http) {
        TrumbowygTidyPlugin.editor = editor;
        editor.plugins.tidy = {
            init: (t) => {
                // console.log('TrumbowygCodemirrorPlugin');
                t.toggle = () => {
                    var prefix = t.o.prefix;
                    t.semanticCode(false, true);
                    setTimeout(function () {
                        t.doc.activeElement.blur();
                        t.$box.toggleClass(prefix + 'editor-hidden ' + prefix + 'editor-visible');
                        t.$btnPane.toggleClass(prefix + 'disable');
                        t.$btnPane.find('.' + prefix + 'viewHTML-button').toggleClass(prefix + 'active');
                        if (t.$box.hasClass(prefix + 'editor-visible')) {
                            t.$ta.attr('tabindex', -1);
                        }
                        else {
                            if (TrumbowygTidyPlugin.editor.tidyUrl) {
                                // console.log(t.$ed.html());
                                http.post(TrumbowygTidyPlugin.editor.tidyUrl, t.$ed.html(), {
                                    responseType: 'text'
                                })
                                    .toPromise()
                                    .then((res) => {
                                    // console.log('tidy res', res.text());
                                    t.$ta.val(res);
                                });
                            }
                            t.$ta.removeAttr('tabindex');
                        }
                    }, 0);
                };
            }
        };
    }
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoidGlkeS5qcyIsInNvdXJjZVJvb3QiOiIvaG9tZS9hc2x1YnNreS93b3JrL2NvbGxhYm9yYXRvci9uZzItdHJ1bWJvd3lnL3NyYy8iLCJzb3VyY2VzIjpbInRpZHkudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IkFBRUEsTUFBTSxPQUFPLG1CQUFtQjtJQUdyQixNQUFNLENBQUMsSUFBSSxDQUFDLE1BQVcsRUFBRSxJQUFZLEVBQUUsSUFBZ0I7UUFDMUQsbUJBQW1CLENBQUMsTUFBTSxHQUFHLE1BQU0sQ0FBQztRQUVwQyxNQUFNLENBQUMsT0FBTyxDQUFDLElBQUksR0FBRztZQUNsQixJQUFJLEVBQUUsQ0FBQyxDQUFNLEVBQUUsRUFBRTtnQkFDYiw0Q0FBNEM7Z0JBRTVDLENBQUMsQ0FBQyxNQUFNLEdBQUcsR0FBRyxFQUFFO29CQUNaLElBQUksTUFBTSxHQUFHLENBQUMsQ0FBQyxDQUFDLENBQUMsTUFBTSxDQUFDO29CQUN4QixDQUFDLENBQUMsWUFBWSxDQUFDLEtBQUssRUFBRSxJQUFJLENBQUMsQ0FBQztvQkFDNUIsVUFBVSxDQUFDO3dCQUNQLENBQUMsQ0FBQyxHQUFHLENBQUMsYUFBYSxDQUFDLElBQUksRUFBRSxDQUFDO3dCQUMzQixDQUFDLENBQUMsSUFBSSxDQUFDLFdBQVcsQ0FBQyxNQUFNLEdBQUcsZ0JBQWdCLEdBQUcsTUFBTSxHQUFHLGdCQUFnQixDQUFDLENBQUM7d0JBQzFFLENBQUMsQ0FBQyxRQUFRLENBQUMsV0FBVyxDQUFDLE1BQU0sR0FBRyxTQUFTLENBQUMsQ0FBQzt3QkFDM0MsQ0FBQyxDQUFDLFFBQVEsQ0FBQyxJQUFJLENBQUMsR0FBRyxHQUFHLE1BQU0sR0FBRyxpQkFBaUIsQ0FBQyxDQUFDLFdBQVcsQ0FBQyxNQUFNLEdBQUcsUUFBUSxDQUFDLENBQUM7d0JBQ2pGLElBQUksQ0FBQyxDQUFDLElBQUksQ0FBQyxRQUFRLENBQUMsTUFBTSxHQUFHLGdCQUFnQixDQUFDLEVBQUU7NEJBQzVDLENBQUMsQ0FBQyxHQUFHLENBQUMsSUFBSSxDQUFDLFVBQVUsRUFBRSxDQUFDLENBQUMsQ0FBQyxDQUFDO3lCQUM5Qjs2QkFBTTs0QkFDSCxJQUFJLG1CQUFtQixDQUFDLE1BQU0sQ0FBQyxPQUFPLEVBQUU7Z0NBQ3BDLDZCQUE2QjtnQ0FDN0IsSUFBSSxDQUFDLElBQUksQ0FDTCxtQkFBbUIsQ0FBQyxNQUFNLENBQUMsT0FBTyxFQUNsQyxDQUFDLENBQUMsR0FBRyxDQUFDLElBQUksRUFBRSxFQUFFO29DQUNWLFlBQVksRUFBRSxNQUFNO2lDQUN2QixDQUFDO3FDQUNELFNBQVMsRUFBRTtxQ0FDWCxJQUFJLENBQUMsQ0FBQyxHQUFRLEVBQUUsRUFBRTtvQ0FDZix1Q0FBdUM7b0NBQ3ZDLENBQUMsQ0FBQyxHQUFHLENBQUMsR0FBRyxDQUFDLEdBQUcsQ0FBQyxDQUFDO2dDQUNuQixDQUFDLENBQUMsQ0FBQzs2QkFDVjs0QkFDRCxDQUFDLENBQUMsR0FBRyxDQUFDLFVBQVUsQ0FBQyxVQUFVLENBQUMsQ0FBQzt5QkFDaEM7b0JBQ0wsQ0FBQyxFQUFFLENBQUMsQ0FBQyxDQUFDO2dCQUNWLENBQUMsQ0FBQztZQUNOLENBQUM7U0FDSixDQUFBO0lBQ0wsQ0FBQztDQUNKIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHtIdHRwQ2xpZW50fSBmcm9tICdAYW5ndWxhci9jb21tb24vaHR0cCc7XG5cbmV4cG9ydCBjbGFzcyBUcnVtYm93eWdUaWR5UGx1Z2luIHtcbiAgICBwdWJsaWMgc3RhdGljIGVkaXRvcjogYW55O1xuXG4gICAgcHVibGljIHN0YXRpYyBpbml0KGVkaXRvcjogYW55LCBsYW5nOiBzdHJpbmcsIGh0dHA6IEh0dHBDbGllbnQpIHtcbiAgICAgICAgVHJ1bWJvd3lnVGlkeVBsdWdpbi5lZGl0b3IgPSBlZGl0b3I7XG5cbiAgICAgICAgZWRpdG9yLnBsdWdpbnMudGlkeSA9IHtcbiAgICAgICAgICAgIGluaXQ6ICh0OiBhbnkpID0+IHtcbiAgICAgICAgICAgICAgICAvLyBjb25zb2xlLmxvZygnVHJ1bWJvd3lnQ29kZW1pcnJvclBsdWdpbicpO1xuXG4gICAgICAgICAgICAgICAgdC50b2dnbGUgPSAoKSA9PiB7XG4gICAgICAgICAgICAgICAgICAgIHZhciBwcmVmaXggPSB0Lm8ucHJlZml4O1xuICAgICAgICAgICAgICAgICAgICB0LnNlbWFudGljQ29kZShmYWxzZSwgdHJ1ZSk7XG4gICAgICAgICAgICAgICAgICAgIHNldFRpbWVvdXQoZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgdC5kb2MuYWN0aXZlRWxlbWVudC5ibHVyKCk7XG4gICAgICAgICAgICAgICAgICAgICAgICB0LiRib3gudG9nZ2xlQ2xhc3MocHJlZml4ICsgJ2VkaXRvci1oaWRkZW4gJyArIHByZWZpeCArICdlZGl0b3ItdmlzaWJsZScpO1xuICAgICAgICAgICAgICAgICAgICAgICAgdC4kYnRuUGFuZS50b2dnbGVDbGFzcyhwcmVmaXggKyAnZGlzYWJsZScpO1xuICAgICAgICAgICAgICAgICAgICAgICAgdC4kYnRuUGFuZS5maW5kKCcuJyArIHByZWZpeCArICd2aWV3SFRNTC1idXR0b24nKS50b2dnbGVDbGFzcyhwcmVmaXggKyAnYWN0aXZlJyk7XG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAodC4kYm94Lmhhc0NsYXNzKHByZWZpeCArICdlZGl0b3ItdmlzaWJsZScpKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdC4kdGEuYXR0cigndGFiaW5kZXgnLCAtMSk7XG4gICAgICAgICAgICAgICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChUcnVtYm93eWdUaWR5UGx1Z2luLmVkaXRvci50aWR5VXJsKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vIGNvbnNvbGUubG9nKHQuJGVkLmh0bWwoKSk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGh0dHAucG9zdChcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIFRydW1ib3d5Z1RpZHlQbHVnaW4uZWRpdG9yLnRpZHlVcmwsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0LiRlZC5odG1sKCksIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXNwb25zZVR5cGU6ICd0ZXh0J1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfSlcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC50b1Byb21pc2UoKVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLnRoZW4oKHJlczogYW55KSA9PiB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8gY29uc29sZS5sb2coJ3RpZHkgcmVzJywgcmVzLnRleHQoKSk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdC4kdGEudmFsKHJlcyk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdC4kdGEucmVtb3ZlQXR0cigndGFiaW5kZXgnKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgfSwgMCk7XG4gICAgICAgICAgICAgICAgfTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgIH1cbn1cbiJdfQ==