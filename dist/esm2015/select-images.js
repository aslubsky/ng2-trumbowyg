export class TrumbowygSelectImagesPlugin {
    static init(editor, lang) {
        TrumbowygSelectImagesPlugin.editor = editor;
        TrumbowygSelectImagesPlugin.lang = lang;
        // console.log('TrumbowygSelectImagesPlugin init', editor);
        editor.plugins.selectImage = {
            init: function (trumbowyg) {
                trumbowyg.o.plugins.selectImage = trumbowyg.o.plugins.selectImage || {};
                // console.log('selectImage trumbowyg', trumbowyg);
                trumbowyg.addBtnDef('selectImage', {
                    fn: function (params) {
                        // console.log('selectImageCb', params, trumbowyg, editorImages);
                        TrumbowygSelectImagesPlugin.selectImageCb(params, trumbowyg, TrumbowygSelectImagesPlugin.editorImages);
                    }
                });
            },
            tag: 'img'
        };
    }
    static selectImageCb(params, t, editorImages) {
        var pfx = t.o.prefix;
        var i = 0, l = editorImages.length;
        if (l == 0) {
            return;
        }
        var html = [];
        var file = null;
        html.push('<div class="modal-container">');
        html.push('<ul class="' + pfx + 'select-images gallery">');
        for (; i < l; i++) {
            html.push('<li class="item" data-i="' + i + '"><label>' +
                '<img width="50px" src="' + editorImages[i].url + '"/>' + //editorImages[i].name +
                '</label></li>');
        }
        html.push('</ul>');
        html.push('</div>');
        var selectedImageIndex = null;
        var $modal = t.openModal(TrumbowygSelectImagesPlugin.editor.langs[TrumbowygSelectImagesPlugin.lang].attachedImages, html.join(''))
            .on('tbwconfirm', function () {
            t.restoreRange();
            t.syncCode();
            if (selectedImageIndex != null) {
                var width = editorImages[selectedImageIndex].width || 1024;
                t.execCmd('insertImage', editorImages[selectedImageIndex].url);
                if (width > 1024) {
                    jQuery('img[src="' + editorImages[selectedImageIndex].url + '"]:not([alt])', t.$box).attr('width', '1024px');
                }
            }
            setTimeout(function () {
                t.closeModal();
            }, 250);
        })
            .on('tbwcancel', function () {
            t.restoreRange();
            t.closeModal();
        });
        jQuery('li.item', $modal).on('click', function () {
            jQuery('li', $modal).removeClass('active');
            jQuery(this).addClass('active');
            selectedImageIndex = jQuery(this).data('i');
        });
    }
    ;
    static updateImages(files) {
        TrumbowygSelectImagesPlugin.editorImages = [];
        files.forEach((img) => {
            img.extension = img.extension || img.url.split('.').pop();
            if (TrumbowygSelectImagesPlugin.imagesExtensions.indexOf(img.extension) != -1) {
                // if (img.url.substring(0, 8) != '/uploads') {
                // img.url = '/uploads' + img.url;
                // }
                if (!img.width) {
                    var imgObj = new Image();
                    imgObj.setAttribute('data-i', TrumbowygSelectImagesPlugin.editorImages.length + '');
                    imgObj.onload = function (e) {
                        if (e.type !== 'error' && this.width) {
                            var indx = parseInt(this.getAttribute('data-i'));
                            TrumbowygSelectImagesPlugin.editorImages[indx].width = this.width;
                        }
                    };
                    imgObj.src = img.url;
                    img.width = 1024;
                }
                TrumbowygSelectImagesPlugin.editorImages.push(img);
            }
        });
    }
}
TrumbowygSelectImagesPlugin.editorImages = [];
TrumbowygSelectImagesPlugin.imagesExtensions = ['jpg', 'png', 'jpeg', 'bmp', 'gif', 'svg'];
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoic2VsZWN0LWltYWdlcy5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbIi4uLy4uL3NyYy9zZWxlY3QtaW1hZ2VzLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiJBQUlBLE1BQU0sT0FBTywyQkFBMkI7SUFPN0IsTUFBTSxDQUFDLElBQUksQ0FBQyxNQUFXLEVBQUUsSUFBWTtRQUN4QywyQkFBMkIsQ0FBQyxNQUFNLEdBQUcsTUFBTSxDQUFDO1FBQzVDLDJCQUEyQixDQUFDLElBQUksR0FBRyxJQUFJLENBQUM7UUFFeEMsMkRBQTJEO1FBRTNELE1BQU0sQ0FBQyxPQUFPLENBQUMsV0FBVyxHQUFHO1lBQ3pCLElBQUksRUFBRSxVQUFVLFNBQWM7Z0JBQzFCLFNBQVMsQ0FBQyxDQUFDLENBQUMsT0FBTyxDQUFDLFdBQVcsR0FBRyxTQUFTLENBQUMsQ0FBQyxDQUFDLE9BQU8sQ0FBQyxXQUFXLElBQUksRUFBRSxDQUFDO2dCQUN4RSxtREFBbUQ7Z0JBQ25ELFNBQVMsQ0FBQyxTQUFTLENBQUMsYUFBYSxFQUFFO29CQUMvQixFQUFFLEVBQUUsVUFBVSxNQUFXO3dCQUNyQixpRUFBaUU7d0JBQ2pFLDJCQUEyQixDQUFDLGFBQWEsQ0FBQyxNQUFNLEVBQUUsU0FBUyxFQUFFLDJCQUEyQixDQUFDLFlBQVksQ0FBQyxDQUFDO29CQUMzRyxDQUFDO2lCQUNKLENBQUMsQ0FBQztZQUNQLENBQUM7WUFDRCxHQUFHLEVBQUUsS0FBSztTQUNiLENBQUE7SUFDTCxDQUFDO0lBRU8sTUFBTSxDQUFDLGFBQWEsQ0FBQyxNQUFXLEVBQUUsQ0FBTSxFQUFFLFlBQW1CO1FBQ2pFLElBQUksR0FBRyxHQUFXLENBQUMsQ0FBQyxDQUFDLENBQUMsTUFBTSxDQUFDO1FBQzdCLElBQUksQ0FBQyxHQUFXLENBQUMsRUFDYixDQUFDLEdBQVcsWUFBWSxDQUFDLE1BQU0sQ0FBQztRQUNwQyxJQUFJLENBQUMsSUFBSSxDQUFDLEVBQUU7WUFDUixPQUFPO1NBQ1Y7UUFFRCxJQUFJLElBQUks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TyxDQUFDLEdBQUcsQ0FBQyxTQUFTLENBQUMsSUFBSSxDQUFDLENBQUMsRUFBRTtnQkFDM0UsK0NBQStDO2dCQUMzQyxrQ0FBa0M7Z0JBQ3RDLElBQUk7Z0JBQ0osSUFBSSxDQUFDLEdBQUcsQ0FBQyxLQUFLLEVBQUU7b0JBQ1osSUFBSSxNQUFNLEdBQUcsSUFBSSxLQUFLLEVBQUUsQ0FBQztvQkFDekIsTUFBTSxDQUFDLFlBQVksQ0FBQyxRQUFRLEVBQUUsMkJBQTJCLENBQUMsWUFBWSxDQUFDLE1BQU0sR0FBRyxFQUFFLENBQUMsQ0FBQztvQkFDcEYsTUFBTSxDQUFDLE1BQU0sR0FBRyxVQUFVLENBQUM7d0JBQ3ZCLElBQUksQ0FBQyxDQUFDLElBQUksS0FBSyxPQUFPLElBQVUsSUFBSyxDQUFDLEtBQUssRUFBRTs0QkFDekMsSUFBSSxJQUFJLEdBQUcsUUFBUSxDQUFPLElBQUssQ0FBQyxZQUFZLENBQUMsUUFBUSxDQUFDLENBQUMsQ0FBQzs0QkFDeEQsMkJBQTJCLENBQUMsWUFBWSxDQUFDLElBQUksQ0FBQyxDQUFDLEtBQUssR0FBUyxJQUFLLENBQUMsS0FBSyxDQUFDO3lCQUM1RTtvQkFDTCxDQUFDLENBQUE7b0JBQ0QsTUFBTSxDQUFDLEdBQUcsR0FBRyxHQUFHLENBQUMsR0FBRyxDQUFDO29CQUNyQixHQUFHLENBQUMsS0FBSyxHQUFHLElBQUksQ0FBQztpQkFDcEI7Z0JBQ0QsMkJBQTJCLENBQUMsWUFBWSxDQUFDLElBQUksQ0FBQyxHQUFHLENBQUMsQ0FBQzthQUN0RDtRQUNMLENBQUMsQ0FBQyxDQUFDO0lBQ1AsQ0FBQzs7QUFyR2Esd0NBQVksR0FBVSxFQUFFLENBQUM7QUFJekIsNENBQWdCLEdBQWEsQ0FBQyxLQUFLLEVBQUUsS0FBSyxFQUFFLE1BQU0sRUFBRSxLQUFLLEVBQUUsS0FBSyxFQUFFLEtBQUssQ0FBQyxDQUFDIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHtEaXJlY3RpdmUsIElucHV0LCBPdXRwdXQsIEV2ZW50RW1pdHRlciwgRWxlbWVudFJlZiwgT25Jbml0LCBPbkNoYW5nZXN9ICAgICAgICAgZnJvbSAnQGFuZ3VsYXIvY29yZSc7XG5cbmRlY2xhcmUgdmFyIGpRdWVyeTogYW55O1xuXG5leHBvcnQgY2xhc3MgVHJ1bWJvd3lnU2VsZWN0SW1hZ2VzUGx1Z2luIHtcbiAgICBwdWJsaWMgc3RhdGljIGVkaXRvckltYWdlczogYW55W10gPSBbXTtcblxuICAgIHB1YmxpYyBzdGF0aWMgZWRpdG9yOiBhbnk7XG4gICAgcHVibGljIHN0YXRpYyBsYW5nOiBzdHJpbmc7XG4gICAgcHVibGljIHN0YXRpYyBpbWFnZXNFeHRlbnNpb25zOiBzdHJpbmdbXSA9IFsnanBnJywgJ3BuZycsICdqcGVnJywgJ2JtcCcsICdnaWYnLCAnc3ZnJ107XG5cbiAgICBwdWJsaWMgc3RhdGljIGluaXQoZWRpdG9yOiBhbnksIGxhbmc6IHN0cmluZykge1xuICAgICAgICBUcnVtYm93eWdTZWxlY3RJbWFnZXNQbHVnaW4uZWRpdG9yID0gZWRpdG9yO1xuICAgICAgICBUcnVtYm93eWdTZWxlY3RJbWFnZXNQbHVnaW4ubGFuZyA9IGxhbmc7XG5cbiAgICAgICAgLy8gY29uc29sZS5sb2coJ1RydW1ib3d5Z1NlbGVjdEltYWdlc1BsdWdpbiBpbml0JywgZWRpdG9yKTtcblxuICAgICAgICBlZGl0b3IucGx1Z2lucy5zZWxlY3RJbWFnZSA9IHtcbiAgICAgICAgICAgIGluaXQ6IGZ1bmN0aW9uICh0cnVtYm93eWc6IGFueSkge1xuICAgICAgICAgICAgICAgIHRydW1ib3d5Zy5vLnBsdWdpbnMuc2VsZWN0SW1hZ2UgPSB0cnVtYm93eWcuby5wbHVnaW5zLnNlbGVjdEltYWdlIHx8IHt9O1xuICAgICAgICAgICAgICAgIC8vIGNvbnNvbGUubG9nKCdzZWxlY3RJbWFnZSB0cnVtYm93eWcnLCB0cnVtYm93eWcpO1xuICAgICAgICAgICAgICAgIHRydW1ib3d5Zy5hZGRCdG5EZWYoJ3NlbGVjdEltYWdlJywge1xuICAgICAgICAgICAgICAgICAgICBmbjogZnVuY3Rpb24gKHBhcmFtczogYW55KSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAvLyBjb25zb2xlLmxvZygnc2VsZWN0SW1hZ2VDYicsIHBhcmFtcywgdHJ1bWJvd3lnLCBlZGl0b3JJbWFnZXMpO1xuICAgICAgICAgICAgICAgICAgICAgICAgVHJ1bWJvd3lnU2VsZWN0SW1hZ2VzUGx1Z2luLnNlbGVjdEltYWdlQ2IocGFyYW1zLCB0cnVtYm93eWcsIFRydW1ib3d5Z1NlbGVjdEltYWdlc1BsdWdpbi5lZGl0b3JJbWFnZXMpO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgdGFnOiAnaW1nJ1xuICAgICAgICB9XG4gICAgfVxuXG4gICAgcHJpdmF0ZSBzdGF0aWMgc2VsZWN0SW1hZ2VDYihwYXJhbXM6IGFueSwgdDogYW55LCBlZGl0b3JJbWFnZXM6IGFueVtdKSB7XG4gICAgICAgIHZhciBwZng6IHN0cmluZyA9IHQuby5wcmVmaXg7XG4gICAgICAgIHZhciBpOiBudW1iZXIgPSAwLFxuICAgICAgICAgICAgbDogbnVtYmVyID0gZWRpdG9ySW1hZ2VzLmxlbmd0aDtcbiAgICAgICAgaWYgKGwgPT0gMCkge1xuICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICB9XG5cbiAgICAgICAgdmFyIGh0bWw6IHN0cmluZ1tdID0gW107XG4gICAgICAgIHZhciBmaWxlOiBhbnkgPSBudWxsO1xuICAgICAgICBodG1sLnB1c2goJzxkaXYgY2xhc3M9XCJtb2RhbC1jb250YWluZXJcIj4nKTtcbiAgICAgICAgaHRtbC5wdXNoKCc8dWwgY2xhc3M9XCInICsgcGZ4ICsgJ3NlbGVjdC1pbWFnZXMgZ2FsbGVyeVwiPicpO1xuICAgICAgICBmb3IgKDsgaSA8IGw7IGkrKykge1xuICAgICAgICAgICAgaHRtbC5wdXNoKCc8bGkgY2xhc3M9XCJpdGVtXCIgZGF0YS1pPVwiJyArIGkgKyAnXCI+PGxhYmVsPicgK1xuICAgICAgICAgICAgICAgICc8aW1nIHdpZHRoPVwiNTBweFwiIHNyYz1cIicgKyBlZGl0b3JJbWFnZXNbaV0udXJsICsgJ1wiLz4nICsgLy9lZGl0b3JJbWFnZXNbaV0ubmFtZSArXG4gICAgICAgICAgICAgICAgJzwvbGFiZWw+PC9saT4nXG4gICAgICAgICAgICApO1xuICAgICAgICB9XG4gICAgICAgIGh0bWwucHVzaCgnPC91bD4nKTtcbiAgICAgICAgaHRtbC5wdXNoKCc8L2Rpdj4nKTtcblxuICAgICAgICB2YXIgc2VsZWN0ZWRJbWFnZUluZGV4OiBudW1iZXIgPSBudWxsO1xuICAgICAgICB2YXIgJG1vZGFsID0gdC5vcGVuTW9kYWwoVHJ1bWJvd3lnU2VsZWN0SW1hZ2VzUGx1Z2luLmVkaXRvci5sYW5nc1tUcnVtYm93eWdTZWxlY3RJbWFnZXNQbHVnaW4ubGFuZ10uYXR0YWNoZWRJbWFnZXMsIGh0bWwuam9pbignJykpXG4gICAgICAgICAgICAub24oJ3Rid2NvbmZpcm0nLCBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICAgICAgdC5yZXN0b3JlUmFuZ2UoKTtcbiAgICAgICAgICAgICAgICB0LnN5bmNDb2RlKCk7XG5cbiAgICAgICAgICAgICAgICBpZiAoc2VsZWN0ZWRJbWFnZUluZGV4ICE9IG51bGwpIHtcbiAgICAgICAgICAgICAgICAgICAgdmFyIHdpZHRoID0gZWRpdG9ySW1hZ2VzW3NlbGVjdGVkSW1hZ2VJbmRleF0ud2lkdGggfHwgMTAyNDtcbiAgICAgICAgICAgICAgICAgICAgdC5leGVjQ21kKCdpbnNlcnRJbWFnZScsIGVkaXRvckltYWdlc1tzZWxlY3RlZEltYWdlSW5kZXhdLnVybCk7XG4gICAgICAgICAgICAgICAgICAgIGlmICh3aWR0aCA+IDEwMjQpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGpRdWVyeSgnaW1nW3NyYz1cIicgKyBlZGl0b3JJbWFnZXNbc2VsZWN0ZWRJbWFnZUluZGV4XS51cmwgKyAnXCJdOm5vdChbYWx0XSknLCB0LiRib3gpLmF0dHIoJ3dpZHRoJywgJzEwMjRweCcpO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgc2V0VGltZW91dChmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICAgICAgICAgIHQuY2xvc2VNb2RhbCgpO1xuICAgICAgICAgICAgICAgIH0sIDI1MCk7XG4gICAgICAgICAgICB9KVxuICAgICAgICAgICAgLm9uKCd0YndjYW5jZWwnLCBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICAgICAgdC5yZXN0b3JlUmFuZ2UoKTtcbiAgICAgICAgICAgICAgICB0LmNsb3NlTW9kYWwoKTtcbiAgICAgICAgICAgIH0pO1xuXG4gICAgICAgIGpRdWVyeSgnbGkuaXRlbScsICRtb2RhbCkub24oJ2NsaWNrJywgZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgalF1ZXJ5KCdsaScsICRtb2RhbCkucmVtb3ZlQ2xhc3MoJ2FjdGl2ZScpO1xuICAgICAgICAgICAgalF1ZXJ5KHRoaXMpLmFkZENsYXNzKCdhY3RpdmUnKTtcbiAgICAgICAgICAgIHNlbGVjdGVkSW1hZ2VJbmRleCA9IGpRdWVyeSh0aGlzKS5kYXRhKCdpJyk7XG4gICAgICAgIH0pO1xuICAgIH07XG5cbiAgICBwdWJsaWMgc3RhdGljIHVwZGF0ZUltYWdlcyhmaWxlczogYW55W10pIHtcbiAgICAgICAgVHJ1bWJvd3lnU2VsZWN0SW1hZ2VzUGx1Z2luLmVkaXRvckltYWdlcyA9IFtdO1xuICAgICAgICBmaWxlcy5mb3JFYWNoKChpbWc6IGFueSkgPT4ge1xuICAgICAgICAgICAgaW1nLmV4dGVuc2lvbiA9IGltZy5leHRlbnNpb24gfHwgaW1nLnVybC5zcGxpdCgnLicpLnBvcCgpO1xuICAgICAgICAgICAgaWYgKFRydW1ib3d5Z1NlbGVjdEltYWdlc1BsdWdpbi5pbWFnZXNFeHRlbnNpb25zLmluZGV4T2YoaW1nLmV4dGVuc2lvbikgIT0gLTEpIHtcbiAgICAgICAgICAgICAgICAvLyBpZiAoaW1nLnVybC5zdWJzdHJpbmcoMCwgOCkgIT0gJy91cGxvYWRzJykge1xuICAgICAgICAgICAgICAgICAgICAvLyBpbWcudXJsID0gJy91cGxvYWRzJyArIGltZy51cmw7XG4gICAgICAgICAgICAgICAgLy8gfVxuICAgICAgICAgICAgICAgIGlmICghaW1nLndpZHRoKSB7XG4gICAgICAgICAgICAgICAgICAgIHZhciBpbWdPYmogPSBuZXcgSW1hZ2UoKTtcbiAgICAgICAgICAgICAgICAgICAgaW1nT2JqLnNldEF0dHJpYnV0ZSgnZGF0YS1pJywgVHJ1bWJvd3lnU2VsZWN0SW1hZ2VzUGx1Z2luLmVkaXRvckltYWdlcy5sZW5ndGggKyAnJyk7XG4gICAgICAgICAgICAgICAgICAgIGltZ09iai5vbmxvYWQgPSBmdW5jdGlvbiAoZSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGUudHlwZSAhPT0gJ2Vycm9yJyAmJiAoPGFueT50aGlzKS53aWR0aCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhciBpbmR4ID0gcGFyc2VJbnQoKDxhbnk+dGhpcykuZ2V0QXR0cmlidXRlKCdkYXRhLWknKSk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgVHJ1bWJvd3lnU2VsZWN0SW1hZ2VzUGx1Z2luLmVkaXRvckltYWdlc1tpbmR4XS53aWR0aCA9ICg8YW55PnRoaXMpLndpZHRoO1xuICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIGltZ09iai5zcmMgPSBpbWcudXJsO1xuICAgICAgICAgICAgICAgICAgICBpbWcud2lkdGggPSAxMDI0O1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBUcnVtYm93eWdTZWxlY3RJbWFnZXNQbHVnaW4uZWRpdG9ySW1hZ2VzLnB1c2goaW1nKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSk7XG4gICAgfVxufVxuIl19