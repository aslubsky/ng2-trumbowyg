import { EventEmitter } from '@angular/core';
export class TrumbowygSelectResourcesPlugin {
    static init(editor, lang) {
        TrumbowygSelectResourcesPlugin.editor = editor;
        TrumbowygSelectResourcesPlugin.lang = lang;
        // TrumbowygSelectResourcesPlugin.onSearch = new EventEmitter();
        editor.plugins.selectResources = {
            init: function (trumbowyg) {
                trumbowyg.o.plugins.selectResources = trumbowyg.o.plugins.selectResources || {};
                trumbowyg.addBtnDef('selectResources', {
                    fn: function (params) {
                        // console.log('selectImageCb', params, trumbowyg, editorImages);
                        TrumbowygSelectResourcesPlugin.selectResourcesCb(params, trumbowyg);
                    }
                });
            },
            tag: 'img'
        };
    }
    static translate(str) {
        return TrumbowygSelectResourcesPlugin.editor.langs[TrumbowygSelectResourcesPlugin.lang][str];
    }
    static renderList(pfx, html, items) {
        items.forEach((resource) => {
            // console.log('resource', resource);
            html.push('<li class="item">');
            html.push('<label>');
            html.push('<input type="radio" name="r' + pfx + '" data-id="' + resource.id + '" ' +
                'title="' + resource.title + '" data-type="' + resource.display_type + '" value="' + resource.id + '"/>');
            html.push('<strong>' + resource.title + '</strong>');
            if (resource.description && resource.description.length > 0) {
                html.push('<br/><i>' + resource.description + '</i>');
            }
            html.push('</label>');
            html.push('</li>');
        });
    }
    static selectResourcesCb(params, t) {
        var pfx = TrumbowygSelectResourcesPlugin.pfx = t.o.prefix;
        //console.log('editorResources', editorResources);
        var html = [];
        html.push('<div class="resources-select modal-container">');
        html.push('<div class="resources-search cbr-input-control">');
        html.push('<label for="text" class="cbr-label">' + TrumbowygSelectResourcesPlugin.translate('selectResourcesSearch') + '</label>');
        html.push('<input class="cbr-input cbr-input-default cbr-input-email" type="text">');
        html.push('<span class="cbr-icon-input cbr-icon-input-primary">');
        html.push('<svg version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px"');
        html.push('width="20" height="20" viewBox="0 0 451 451" style="enable-background:new 0 0 451 451;" xml:space="preserve">');
        html.push('<g>');
        html.push('<path d="M447.05,428l-109.6-109.6c29.4-33.8,47.2-77.9,47.2-126.1C384.65,86.2,298.35,0,192.35,0C86.25,0,0.05,86.3,0.05,192.3');
        html.push('s86.3,192.3,192.3,192.3c48.2,0,92.3-17.8,126.1-47.2L428.05,447c2.6,2.6,6.1,4,9.5,4s6.9-1.3,9.5-4');
        html.push('C452.25,441.8,452.25,433.2,447.05,428z M26.95,192.3c0-91.2,74.2-165.3,165.3-165.3c91.2,0,165.3,74.2,165.3,165.3');
        html.push('s-74.1,165.4-165.3,165.4C101.15,357.7,26.95,283.5,26.95,192.3z"/>');
        html.push('</g>');
        html.push('</svg>');
        html.push('</span>');
        html.push('</div>');
        html.push('<ul class="cbr2-tabs" role="tablist">');
        html.push('<li role="all" class="cbr2-tabs-itemactive">');
        html.push('   <a data-type="all"  role="tab">' + TrumbowygSelectResourcesPlugin.translate('selectResourcesAll') + '</a>');
        html.push('</li>');
        html.push('<li role="gallery" class="cbr2-tabs-item">');
        html.push('   <a data-type="gallery" role="tab">' + TrumbowygSelectResourcesPlugin.translate('selectResourcesGallery') + '</a>');
        html.push('</li>');
        html.push('<li role="html" class="cbr2-tabs-item">');
        html.push('   <a data-type="html" role="tab">' + TrumbowygSelectResourcesPlugin.translate('selectResourcesHtmlSite') + '</a>');
        html.push('</li>');
        html.push('<li role="video" class="cbr2-tabs-item">');
        html.push('   <a data-type="video" role="tab">' + TrumbowygSelectResourcesPlugin.translate('selectResourcesVideo') + '</a>');
        html.push('</li>');
        html.push('<li role="audio" class="cbr2-tabs-item">');
        html.push('   <a data-type="audio" role="tab">' + TrumbowygSelectResourcesPlugin.translate('selectResourcesAudio') + '</a>');
        html.push('</li>');
        html.push('</ul>');
        html.push('<div class="cbr-tab-content">');
        html.push('   <div role="tabpanel" class="cbr-tab-pane active">');
        html.push('   <ul class="resources-list list-unstyled">');
        TrumbowygSelectResourcesPlugin.renderList(pfx, html, TrumbowygSelectResourcesPlugin.editorResources);
        html.push('   </ul>');
        html.push('</div>');
        html.push('</div>');
        html.push('</div>');
        //console.log('html', html);
        var $modal = TrumbowygSelectResourcesPlugin.$modal = t.openModal(TrumbowygSelectResourcesPlugin.translate('selectResourcesHeader'), html.join(''))
            .on('tbwconfirm', function () {
            var selected = jQuery('input:checked', $modal);
            console.log('selected', selected);
            var val = selected.val();
            //var i = parseInt(selected.data('i'), 10);
            var type = selected.data('type');
            t.restoreRange();
            t.syncCode();
            if (val) {
                if (type === 'mp4') {
                    type = 'video';
                }
                if (type === 'mp3' || type === 'acc') {
                    type = 'audio';
                }
                switch (type) {
                    case 'gallery':
                        // TrumbowygSelectResourcesPlugin.editor.insertHtml(t, '<img resource-in-resource-render ' +
                        //     'data-item-id="' + val + '" data-type="gallery" data-ext="' + type + '" data-gallery-src="' + val + '"' +
                        //     'src="/themes/default/assets/img/inline-gallery.png" />');
                        TrumbowygSelectResourcesPlugin.editor.insertHtml(t, '<iframe resource-in-resource-iframe="" allowfullscreen width="100%" height="640px" frameborder="0" ' +
                            'src="/node_modules/collaborator-gallery/dist/index.html?id=' + val + '" data-item-id="' + val + '" scrolling="no" marginheight="0" ' +
                            'class="no-border embed-responsive-item"></iframe>');
                        break;
                    case 'video':
                        // TrumbowygSelectResourcesPlugin.editor.insertHtml(t, '<img resource-in-resource-render ' +
                        //     'data-item-id="' + val + '" data-type="video" data-ext="' + type + '" data-video-src="' + val + '"' +
                        //     'src="/themes/default/assets/img/inline-video.png" />');
                        TrumbowygSelectResourcesPlugin.editor.insertHtml(t, '<iframe resource-in-resource-iframe="" allowfullscreen width="100%" height="480px" frameborder="0" ' +
                            'src="/node_modules/collaborator-video-player/dist/index.html?id=' + val + '" data-item-id="' + val + '" scrolling="no" marginheight="0" ' +
                            'class="no-border embed-responsive-item"></iframe>');
                        break;
                    case 'audio':
                        // TrumbowygSelectResourcesPlugin.editor.insertHtml(t, '<img resource-in-resource-render ' +
                        //     'data-item-id="' + val + '" data-type="audio" data-ext="' + type + '" data-src="' + val + '"' +
                        //     'src="/themes/default/assets/img/inline-audio.png" />');
                        TrumbowygSelectResourcesPlugin.editor.insertHtml(t, '<iframe resource-in-resource-iframe="" allowfullscreen width="100%" height="65px" frameborder="0" ' +
                            'src="/node_modules/collaborator-audio-player/dist/index.html?id=' + val + '" data-item-id="' + val + '" scrolling="no" marginheight="0" ' +
                            'class="no-border embed-responsive-item"></iframe>');
                        break;
                    case 'html':
                        // TrumbowygSelectResourcesPlugin.editor.insertHtml(t, '<img resource-in-resource-render ' +
                        //     'data-item-id="' + val + '" data-type="html" data-ext="' + type + '" data-src="' + val + '"' +
                        //     'src="/themes/default/assets/img/inline-resource.png" />');
                        TrumbowygSelectResourcesPlugin.editor.insertHtml(t, '<iframe resource-in-resource-iframe="" allowfullscreen width="100%" height="640px" frameborder="0" ' +
                            'src="/node_modules/collaborator-html-player/dist/index.html?id=' + val + '" scrolling="no" marginheight="0" data-item-id="' + val + '" ' +
                            'class="no-border embed-responsive-item"></iframe>');
                        break;
                }
            }
            setTimeout(function () {
                t.closeModal();
            }, 250);
        })
            .on('tbwcancel', function () {
            t.restoreRange();
            t.closeModal();
        });
        jQuery('.cbr2-tabs a', $modal).off('click').on('click', function (e) {
            e.preventDefault();
            jQuery('.cbr2-tabs-item', $modal).removeClass('cbr-tabs-active');
            jQuery(this).parent().addClass('cbr-tabs-active');
            TrumbowygSelectResourcesPlugin.onSearch.emit({
                type: jQuery(this).attr('data-type') || 'all',
                title: jQuery('.cbr-input', $modal).val()
            });
        });
        jQuery('.cbr-icon-input', $modal).off('click').on('click', function () {
            TrumbowygSelectResourcesPlugin.onSearch.emit({
                type: jQuery(this).attr('data-type') || 'all',
                title: jQuery('.cbr-input', $modal).val()
            });
        });
    }
    static updateResources(editorResources) {
        TrumbowygSelectResourcesPlugin.editorResources = editorResources;
        //
        jQuery('.resources-list', TrumbowygSelectResourcesPlugin.$modal).empty();
        var lhtml = [];
        TrumbowygSelectResourcesPlugin.renderList(TrumbowygSelectResourcesPlugin.pfx, lhtml, editorResources);
        jQuery('.resources-list', TrumbowygSelectResourcesPlugin.$modal).append(lhtml.join(''));
    }
}
TrumbowygSelectResourcesPlugin.editorResources = [];
TrumbowygSelectResourcesPlugin.onSearch = new EventEmitter();
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoic2VsZWN0LXJlc291cmNlcy5qcyIsInNvdXJjZVJvb3QiOiIvaG9tZS9hc2x1YnNreS93b3JrL2NvbGxhYm9yYXRvci9uZzItdHJ1bWJvd3lnL3NyYy8iLCJzb3VyY2VzIjpbInNlbGVjdC1yZXNvdXJjZXMudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IkFBQUEsT0FBTyxFQUFDLFlBQVksRUFBQyxNQUFjLGVBQWUsQ0FBQztBQUluRCxNQUFNLE9BQU8sOEJBQThCO0lBVWhDLE1BQU0sQ0FBQyxJQUFJLENBQUMsTUFBVyxFQUFFLElBQVk7UUFDeEMsOEJBQThCLENBQUMsTUFBTSxHQUFHLE1BQU0sQ0FBQztRQUMvQyw4QkFBOEIsQ0FBQyxJQUFJLEdBQUcsSUFBSSxDQUFDO1FBQzNDLGdFQUFnRTtRQUVoRSxNQUFNLENBQUMsT0FBTyxDQUFDLGVBQWUsR0FBRztZQUM3QixJQUFJLEVBQUUsVUFBVSxTQUFjO2dCQUMxQixTQUFTLENBQUMsQ0FBQyxDQUFDLE9BQU8sQ0FBQyxlQUFlLEdBQUcsU0FBUyxDQUFDLENBQUMsQ0FBQyxPQUFPLENBQUMsZUFBZSxJQUFJLEVBQUUsQ0FBQztnQkFDaEYsU0FBUyxDQUFDLFNBQVMsQ0FBQyxpQkFBaUIsRUFBRTtvQkFDbkMsRUFBRSxFQUFFLFVBQVUsTUFBVzt3QkFDckIsaUVBQWlFO3dCQUNqRSw4QkFBOEIsQ0FBQyxpQkFBaUIsQ0FBQyxNQUFNLEVBQUUsU0FBUyxDQUFDLENBQUM7b0JBQ3hFLENBQUM7aUJBQ0osQ0FBQyxDQUFDO1lBQ1AsQ0FBQztZQUNELEdBQUcsRUFBRSxLQUFLO1NBQ2IsQ0FBQTtJQUNMLENBQUM7SUFFTyxNQUFNLENBQUMsU0FBUyxDQUFDLEdBQVc7UUFDaEMsT0FBTyw4QkFBOEIsQ0FBQyxNQUFNLENBQUMsS0FBSyxDQUFDLDhCQUE4QixDQUFDLElBQUksQ0FBQyxDQUFDLEdBQUcsQ0FBQyxDQUFBO0lBQ2hHLENBQUM7SUFFTyxNQUFNLENBQUMsVUFBVSxDQUFDLEdBQVcsRUFBRSxJQUFjLEVBQUUsS0FBWTtRQUMvRCxLQUFLLENBQUMsT0FBTyxDQUFDLENBQUMsUUFBYSxFQUFFLEVBQUU7WUFDNUIscUNBQXFDO1lBQ3JDLElBQUksQ0FBQyxJQUFJLENBQUMsbUJBQW1CLENBQUMsQ0FBQztZQUMvQixJQUFJLENBQUMsSUFBSSxDQUFDLFNBQVMsQ0FBQyxDQUFDO1lBQ3JCLElBQUksQ0FBQyxJQUFJLENBQUMsNkJBQTZCLEdBQUcsR0FBRyxHQUFHLGFBQWEsR0FBRyxRQUFRLENBQUMsRUFBRSxHQUFHLElBQUk7Z0JBQzlFLFNBQVMsR0FBRyxRQUFRLENBQUMsS0FBSyxHQUFHLGVBQWUsR0FBRyxRQUFRLENBQUMsWUFBWSxHQUFHLFdBQVcsR0FBRyxRQUFRLENBQUMsRUFBRSxHQUFHLEtBQUssQ0FBQyxDQUFDO1lBQzlHLElBQUksQ0FBQyxJQUFJLENBQUMsVUFBVSxHQUFHLFFBQVEsQ0FBQyxLQUFLLEdBQUcsV0FBVyxDQUFDLENBQUM7WUFDckQsSUFBSSxRQUFRLENBQUMsV0FBVyxJQUFJLFFBQVEsQ0FBQyxXQUFXLENBQUMsTUFBTSxHQUFHLENBQUMsRUFBRTtnQkFDekQsSUFBSSxDQUFDLElBQUksQ0FBQyxVQUFVLEdBQUcsUUFBUSxDQUFDLFdBQVcsR0FBRyxNQUFNLENBQUMsQ0FBQzthQUN6RDtZQUNELElBQUksQ0FBQyxJQUFJLENBQUMsVUFBVSxDQUFDLENBQUM7WUFDdEIsSUFBSSxDQUFDLElBQUksQ0FBQyxPQUFPLENBQUMsQ0FBQztRQUN2QixDQUFDLENBQUMsQ0FBQztJQUNQLENBQUM7SUFHTyxNQUFNLENBQUMsaUJBQWlCLENBQUMsTUFBVyxFQUFFLENBQU07UUFDaEQsSUFBSSxHQUFHLEdBQUcsOEJBQThCLENBQUMsR0FBRyxHQUFHLENBQUMsQ0FBQyxDQUFDLENBQUMsTUFBTSxDQUFDO1FBQzFELGtEQUFrRDtRQUVsRCxJQUFJLElBQUksR0FBYSxFQUFFLENBQUM7UUFFeEIsSUFBSSxDQUFDLElBQUksQ0FBQyxnREFBZ0QsQ0FBQyxDQUFDO1FBQzVELElBQUksQ0FBQyxJQUFJLENBQUMsa0RBQWtELENBQUMsQ0FBQztRQUM5RCxJQUFJLENBQUMsSUFBSSxDQUFDLHNDQUFzQyxHQUFHLDhCQUE4QixDQUFDLFNBQVMsQ0FBQyx1QkFBdUIsQ0FBQyxHQUFFLFVBQVUsQ0FBQyxDQUFDO1FBQ2xJLElBQUksQ0FBQyxJQUFJLENBQUMseUVBQXlFLENBQUMsQ0FBQztRQUNyRixJQUFJLENBQUMsSUFBSSxDQUFDLHNEQUFzRCxDQUFDLENBQUM7UUFDbEUsSUFBSSxDQUFDLElBQUksQ0FBQyxrSEFBa0gsQ0FBQyxDQUFDO1FBQzlILElBQUksQ0FBQyxJQUFJLENBQUMsK0dBQStHLENBQUMsQ0FBQztRQUMzSCxJQUFJLENBQUMsSUFBSSxDQUFDLEtBQUssQ0FBQyxDQUFDO1FBQ2pCLElBQUksQ0FBQyxJQUFJLENBQUMsNkhBQTZILENBQUMsQ0FBQztRQUN6SSxJQUFJLENBQUMsSUFBSSxDQUFDLGtHQUFrRyxDQUFDLENBQUM7UUFDOUcsSUFBSSxDQUFDLElBQUksQ0FBQyxpSEFBaUgsQ0FBQyxDQUFDO1FBQzdILElBQUksQ0FBQyxJQUFJLENBQUMsbUVBQW1FLENBQUMsQ0FBQztRQUMvRSxJQUFJLENBQUMsSUFBSSxDQUFDLE1BQU0sQ0FBQyxDQUFDO1FBQ2xCLElBQUksQ0FBQyxJQUFJLENBQUMsUUFBUSxDQUFDLENBQUM7UUFDcEIsSUFBSSxDQUFDLElBQUksQ0FBQyxTQUFTLENBQUMsQ0FBQztRQUNyQixJQUFJLENBQUMsSUFBSSxDQUFDLFFBQVEsQ0FBQyxDQUFDO1FBQ3BCLElBQUksQ0FBQyxJQUFJLENBQUMsdUNBQXVDLENBQUMsQ0FBQztRQUNuRCxJQUFJLENBQUMsSUFBSSxDQUFDLDhDQUE4QyxDQUFDLENBQUM7UUFDMUQsSUFBSSxDQUFDLElBQUksQ0FBQyxvQ0FBb0MsR0FBRyw4QkFBOEIsQ0FBQyxTQUFTLENBQUMsb0JBQW9CLENBQUMsR0FBRyxNQUFNLENBQUMsQ0FBQztRQUMxSCxJQUFJLENBQUMsSUFBSSxDQUFDLE9BQU8sQ0FBQyxDQUFDO1FBQ25CLElBQUksQ0FBQyxJQUFJLENBQUMsNENBQTRDLENBQUMsQ0FBQztRQUN4RCxJQUFJLENBQUMsSUFBSSxDQUFDLHVDQUF1QyxHQUFHLDhCQUE4QixDQUFDLFNBQVMsQ0FBQyx3QkFBd0IsQ0FBQyxHQUFHLE1BQU0sQ0FBQyxDQUFDO1FBQ2pJLElBQUksQ0FBQyxJQUFJLENBQUMsT0FBTyxDQUFDLENBQUM7UUFDbkIsSUFBSSxDQUFDLElBQUksQ0FBQyx5Q0FBeUMsQ0FBQyxDQUFDO1FBQ3JELElBQUksQ0FBQyxJQUFJLENBQUMsb0NBQW9DLEdBQUcsOEJBQThCLENBQUMsU0FBUyxDQUFDLHlCQUF5QixDQUFDLEdBQUcsTUFBTSxDQUFDLENBQUM7UUFDL0gsSUFBSSxDQUFDLElBQUksQ0FBQyxPQUFPLENBQUMsQ0FBQztRQUNuQixJQUFJLENBQUMsSUFBSSxDQUFDLDBDQUEwQyxDQUFDLENBQUM7UUFDdEQsSUFBSSxDQUFDLElBQUksQ0FBQyxxQ0FBcUMsR0FBRyw4QkFBOEIsQ0FBQyxTQUFTLENBQUMsc0JBQXNCLENBQUMsR0FBRyxNQUFNLENBQUMsQ0FBQztRQUM3SCxJQUFJLENBQUMsSUFBSSxDQUFDLE9BQU8sQ0FBQyxDQUFDO1FBQ25CLElBQUksQ0FBQyxJQUFJLENBQUMsMENBQTBDLENBQUMsQ0FBQztRQUN0RCxJQUFJLENBQUMsSUFBSSxDQUFDLHFDQUFxQyxHQUFHLDhCQUE4QixDQUFDLFNBQVMsQ0FBQyxzQkFBc0IsQ0FBQyxHQUFHLE1BQU0sQ0FBQyxDQUFDO1FBQzdILElBQUksQ0FBQyxJQUFJLENBQUMsT0FBTyxDQUFDLENBQUM7UUFDbkIsSUFBSSxDQUFDLElBQUksQ0FBQyxPQUFPLENBQUMsQ0FBQztRQUNuQixJQUFJLENBQUMsSUFBSSxDQUFDLCtCQUErQixDQUFDLENBQUM7UUFDM0MsSUFBSSxDQUFDLElBQUksQ0FBQyxzREFBc0QsQ0FBQyxDQUFDO1FBQ2xFLElBQUksQ0FBQyxJQUFJLENBQUMsOENBQThDLENBQUMsQ0FBQztRQUMxRCw4QkFBOEIsQ0FBQyxVQUFVLENBQUMsR0FBRyxFQUFFLElBQUksRUFBRSw4QkFBOEIsQ0FBQyxlQUFlLENBQUMsQ0FBQztRQUNyRyxJQUFJLENBQUMsSUFBSSxDQUFDLFVBQVUsQ0FBQyxDQUFDO1FBQ3RCLElBQUksQ0FBQyxJQUFJLENBQUMsUUFBUSxDQUFDLENBQUM7UUFDcEIsSUFBSSxDQUFDLElBQUksQ0FBQyxRQUFRLENBQUMsQ0FBQztRQUVwQixJQUFJLENBQUMsSUFBSSxDQUFDLFFBQVEsQ0FBQyxDQUFDO1FBRXBCLDRCQUE0QjtRQUM1QixJQUFJLE1BQU0sR0FBRyw4QkFBOEIsQ0FBQyxNQUFNLEdBQUcsQ0FBQyxDQUFDLFNBQVMsQ0FBQyw4QkFBOEIsQ0FBQyxTQUFTLENBQUMsdUJBQXVCLENBQUMsRUFBRSxJQUFJLENBQUMsSUFBSSxDQUFDLEVBQUUsQ0FBQyxDQUFDO2FBQzdJLEVBQUUsQ0FBQyxZQUFZLEVBQUU7WUFFZCxJQUFJLFFBQVEsR0FBRyxNQUFNLENBQUMsZUFBZSxFQUFFLE1BQU0sQ0FBQyxDQUFDO1lBQy9DLE9BQU8sQ0FBQyxHQUFHLENBQUMsVUFBVSxFQUFFLFFBQVEsQ0FBQyxDQUFDO1lBRWxDLElBQUksR0FBRyxHQUFHLFFBQVEsQ0FBQyxHQUFHLEVBQUUsQ0FBQztZQUN6QiwyQ0FBMkM7WUFDM0MsSUFBSSxJQUFJLEdBQUcsUUFBUSxDQUFDLElBQUksQ0FBQyxNQUFNLENBQUMsQ0FBQztZQUVqQyxDQUFDLENBQUMsWUFBWSxFQUFFLENBQUM7WUFDakIsQ0FBQyxDQUFDLFFBQVEsRUFBRSxDQUFDO1lBRWIsSUFBSSxHQUFHLEVBQUU7Z0JBQ0wsSUFBSSxJQUFJLEtBQUssS0FBSyxFQUFFO29CQUNoQixJQUFJLEdBQUcsT0FBTyxDQUFDO2lCQUNsQjtnQkFDRCxJQUFJLElBQUksS0FBSyxLQUFLLElBQUksSUFBSSxLQUFLLEtBQUssRUFBRTtvQkFDbEMsSUFBSSxHQUFHLE9BQU8sQ0FBQztpQkFDbEI7Z0JBRUQsUUFBUSxJQUFJLEVBQUU7b0JBQ1YsS0FBSyxTQUFTO3dCQUNWLDRGQUE0Rjt3QkFDNUYsZ0hBQWdIO3dCQUNoSCxpRUFBaUU7d0JBQ2pFLDhCQUE4QixDQUFDLE1BQU0sQ0FBQyxVQUFVLENBQUMsQ0FBQyxFQUFFLHFHQUFxRzs0QkFDckosNkRBQTZELEdBQUcsR0FBRyxHQUFHLGtCQUFrQixHQUFHLEdBQUcsR0FBRyxvQ0FBb0M7NEJBQ3JJLG1EQUFtRCxDQUFDLENBQUM7d0JBQ3pELE1BQU07b0JBQ1YsS0FBSyxPQUFPO3dCQUNSLDRGQUE0Rjt3QkFDNUYsNEdBQTRHO3dCQUM1RywrREFBK0Q7d0JBQy9ELDhCQUE4QixDQUFDLE1BQU0sQ0FBQyxVQUFVLENBQUMsQ0FBQyxFQUFFLHFHQUFxRzs0QkFDckosa0VBQWtFLEdBQUcsR0FBRyxHQUFHLGtCQUFrQixHQUFHLEdBQUcsR0FBRyxvQ0FBb0M7NEJBQzFJLG1EQUFtRCxDQUFDLENBQUM7d0JBQ3pELE1BQU07b0JBQ1YsS0FBSyxPQUFPO3dCQUNSLDRGQUE0Rjt3QkFDNUYsc0dBQXNHO3dCQUN0RywrREFBK0Q7d0JBQy9ELDhCQUE4QixDQUFDLE1BQU0sQ0FBQyxVQUFVLENBQUMsQ0FBQyxFQUFFLG9HQUFvRzs0QkFDcEosa0VBQWtFLEdBQUcsR0FBRyxHQUFHLGtCQUFrQixHQUFHLEdBQUcsR0FBRyxvQ0FBb0M7NEJBQzFJLG1EQUFtRCxDQUFDLENBQUM7d0JBRXpELE1BQU07b0JBQ1YsS0FBSyxNQUFNO3dCQUNQLDRGQUE0Rjt3QkFDNUYscUdBQXFHO3dCQUNyRyxrRUFBa0U7d0JBQ2xFLDhCQUE4QixDQUFDLE1BQU0sQ0FBQyxVQUFVLENBQUMsQ0FBQyxFQUFFLHFHQUFxRzs0QkFDckosaUVBQWlFLEdBQUcsR0FBRyxHQUFHLGtEQUFrRCxHQUFHLEdBQUcsR0FBRyxJQUFJOzRCQUN6SSxtREFBbUQsQ0FBQyxDQUFDO3dCQUN6RCxNQUFNO2lCQUNiO2FBQ0o7WUFFRCxVQUFVLENBQUM7Z0JBQ1AsQ0FBQyxDQUFDLFVBQVUsRUFBRSxDQUFDO1lBQ25CLENBQUMsRUFBRSxHQUFHLENBQUMsQ0FBQztRQUNaLENBQUMsQ0FBQzthQUNELEVBQUUsQ0FBQyxXQUFXLEVBQUU7WUFDYixDQUFDLENBQUMsWUFBWSxFQUFFLENBQUM7WUFDakIsQ0FBQyxDQUFDLFVBQVUsRUFBRSxDQUFDO1FBQ25CLENBQUMsQ0FBQyxDQUFDO1FBRVAsTUFBTSxDQUFDLGNBQWMsRUFBRSxNQUFNLENBQUMsQ0FBQyxHQUFHLENBQUMsT0FBTyxDQUFDLENBQUMsRUFBRSxDQUFDLE9BQU8sRUFBRSxVQUFVLENBQU07WUFDcEUsQ0FBQyxDQUFDLGNBQWMsRUFBRSxDQUFDO1lBRW5CLE1BQU0sQ0FBQyxpQkFBaUIsRUFBRSxNQUFNLENBQUMsQ0FBQyxXQUFXLENBQUMsaUJBQWlCLENBQUMsQ0FBQztZQUNqRSxNQUFNLENBQUMsSUFBSSxDQUFDLENBQUMsTUFBTSxFQUFFLENBQUMsUUFBUSxDQUFDLGlCQUFpQixDQUFDLENBQUM7WUFFbEQsOEJBQThCLENBQUMsUUFBUSxDQUFDLElBQUksQ0FBQztnQkFDekMsSUFBSSxFQUFFLE1BQU0sQ0FBQyxJQUFJLENBQUMsQ0FBQyxJQUFJLENBQUMsV0FBVyxDQUFDLElBQUksS0FBSztnQkFDN0MsS0FBSyxFQUFFLE1BQU0sQ0FBQyxZQUFZLEVBQUUsTUFBTSxDQUFDLENBQUMsR0FBRyxFQUFFO2FBQzVDLENBQUMsQ0FBQztRQUNQLENBQUMsQ0FBQyxDQUFDO1FBRUgsTUFBTSxDQUFDLGlCQUFpQixFQUFFLE1BQU0sQ0FBQyxDQUFDLEdBQUcsQ0FBQyxPQUFPLENBQUMsQ0FBQyxFQUFFLENBQUMsT0FBTyxFQUFFO1lBQ3ZELDhCQUE4QixDQUFDLFFBQVEsQ0FBQyxJQUFJLENBQUM7Z0JBQ3pDLElBQUksRUFBRSxNQUFNLENBQUMsSUFBSSxDQUFDLENBQUMsSUFBSSxDQUFDLFdBQVcsQ0FBQyxJQUFJLEtBQUs7Z0JBQzdDLEtBQUssRUFBRSxNQUFNLENBQUMsWUFBWSxFQUFFLE1BQU0sQ0FBQyxDQUFDLEdBQUcsRUFBRTthQUM1QyxDQUFDLENBQUM7UUFDUCxDQUFDLENBQUMsQ0FBQztJQUNQLENBQUM7SUFFTSxNQUFNLENBQUMsZUFBZSxDQUFDLGVBQXNCO1FBQ2hELDhCQUE4QixDQUFDLGVBQWUsR0FBRyxlQUFlLENBQUM7UUFDakUsRUFBRTtRQUNGLE1BQU0sQ0FBQyxpQkFBaUIsRUFBRSw4QkFBOEIsQ0FBQyxNQUFNLENBQUMsQ0FBQyxLQUFLLEVBQUUsQ0FBQztRQUN6RSxJQUFJLEtBQUssR0FBYSxFQUFFLENBQUM7UUFDekIsOEJBQThCLENBQUMsVUFBVSxDQUFDLDhCQUE4QixDQUFDLEdBQUcsRUFBRSxLQUFLLEVBQUUsZUFBZSxDQUFDLENBQUM7UUFDdEcsTUFBTSxDQUFDLGlCQUFpQixFQUFFLDhCQUE4QixDQUFDLE1BQU0sQ0FBQyxDQUFDLE1BQU0sQ0FBQyxLQUFLLENBQUMsSUFBSSxDQUFDLEVBQUUsQ0FBQyxDQUFDLENBQUM7SUFDNUYsQ0FBQzs7QUFqTWEsOENBQWUsR0FBVSxFQUFFLENBQUM7QUFFNUIsdUNBQVEsR0FBc0IsSUFBSSxZQUFZLEVBQUUsQ0FBQyIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7RXZlbnRFbWl0dGVyfSAgICAgICAgIGZyb20gJ0Bhbmd1bGFyL2NvcmUnO1xuXG5kZWNsYXJlIHZhciBqUXVlcnk6IGFueTtcblxuZXhwb3J0IGNsYXNzIFRydW1ib3d5Z1NlbGVjdFJlc291cmNlc1BsdWdpbiB7XG4gICAgcHVibGljIHN0YXRpYyBlZGl0b3JSZXNvdXJjZXM6IGFueVtdID0gW107XG5cbiAgICBwdWJsaWMgc3RhdGljIG9uU2VhcmNoOiBFdmVudEVtaXR0ZXI8YW55PiA9IG5ldyBFdmVudEVtaXR0ZXIoKTtcblxuICAgIHB1YmxpYyBzdGF0aWMgZWRpdG9yOiBhbnk7XG4gICAgcHVibGljIHN0YXRpYyAkbW9kYWw6IGFueTtcbiAgICBwdWJsaWMgc3RhdGljIGxhbmc6IHN0cmluZztcbiAgICBwdWJsaWMgc3RhdGljIHBmeDogc3RyaW5nO1xuXG4gICAgcHVibGljIHN0YXRpYyBpbml0KGVkaXRvcjogYW55LCBsYW5nOiBzdHJpbmcpIHtcbiAgICAgICAgVHJ1bWJvd3lnU2VsZWN0UmVzb3VyY2VzUGx1Z2luLmVkaXRvciA9IGVkaXRvcjtcbiAgICAgICAgVHJ1bWJvd3lnU2VsZWN0UmVzb3VyY2VzUGx1Z2luLmxhbmcgPSBsYW5nO1xuICAgICAgICAvLyBUcnVtYm93eWdTZWxlY3RSZXNvdXJjZXNQbHVnaW4ub25TZWFyY2ggPSBuZXcgRXZlbnRFbWl0dGVyKCk7XG5cbiAgICAgICAgZWRpdG9yLnBsdWdpbnMuc2VsZWN0UmVzb3VyY2VzID0ge1xuICAgICAgICAgICAgaW5pdDogZnVuY3Rpb24gKHRydW1ib3d5ZzogYW55KSB7XG4gICAgICAgICAgICAgICAgdHJ1bWJvd3lnLm8ucGx1Z2lucy5zZWxlY3RSZXNvdXJjZXMgPSB0cnVtYm93eWcuby5wbHVnaW5zLnNlbGVjdFJlc291cmNlcyB8fCB7fTtcbiAgICAgICAgICAgICAgICB0cnVtYm93eWcuYWRkQnRuRGVmKCdzZWxlY3RSZXNvdXJjZXMnLCB7XG4gICAgICAgICAgICAgICAgICAgIGZuOiBmdW5jdGlvbiAocGFyYW1zOiBhbnkpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIC8vIGNvbnNvbGUubG9nKCdzZWxlY3RJbWFnZUNiJywgcGFyYW1zLCB0cnVtYm93eWcsIGVkaXRvckltYWdlcyk7XG4gICAgICAgICAgICAgICAgICAgICAgICBUcnVtYm93eWdTZWxlY3RSZXNvdXJjZXNQbHVnaW4uc2VsZWN0UmVzb3VyY2VzQ2IocGFyYW1zLCB0cnVtYm93eWcpO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgdGFnOiAnaW1nJ1xuICAgICAgICB9XG4gICAgfVxuXG4gICAgcHJpdmF0ZSBzdGF0aWMgdHJhbnNsYXRlKHN0cjogc3RyaW5nKSB7XG4gICAgICAgIHJldHVybiBUcnVtYm93eWdTZWxlY3RSZXNvdXJjZXNQbHVnaW4uZWRpdG9yLmxhbmdzW1RydW1ib3d5Z1NlbGVjdFJlc291cmNlc1BsdWdpbi5sYW5nXVtzdHJdXG4gICAgfVxuXG4gICAgcHJpdmF0ZSBzdGF0aWMgcmVuZGVyTGlzdChwZng6IHN0cmluZywgaHRtbDogc3RyaW5nW10sIGl0ZW1zOiBhbnlbXSkge1xuICAgICAgICBpdGVtcy5mb3JFYWNoKChyZXNvdXJjZTogYW55KSA9PiB7XG4gICAgICAgICAgICAvLyBjb25zb2xlLmxvZygncmVzb3VyY2UnLCByZXNvdXJjZSk7XG4gICAgICAgICAgICBodG1sLnB1c2goJzxsaSBjbGFzcz1cIml0ZW1cIj4nKTtcbiAgICAgICAgICAgIGh0bWwucHVzaCgnPGxhYmVsPicpO1xuICAgICAgICAgICAgaHRtbC5wdXNoKCc8aW5wdXQgdHlwZT1cInJhZGlvXCIgbmFtZT1cInInICsgcGZ4ICsgJ1wiIGRhdGEtaWQ9XCInICsgcmVzb3VyY2UuaWQgKyAnXCIgJyArXG4gICAgICAgICAgICAgICAgJ3RpdGxlPVwiJyArIHJlc291cmNlLnRpdGxlICsgJ1wiIGRhdGEtdHlwZT1cIicgKyByZXNvdXJjZS5kaXNwbGF5X3R5cGUgKyAnXCIgdmFsdWU9XCInICsgcmVzb3VyY2UuaWQgKyAnXCIvPicpO1xuICAgICAgICAgICAgaHRtbC5wdXNoKCc8c3Ryb25nPicgKyByZXNvdXJjZS50aXRsZSArICc8L3N0cm9uZz4nKTtcbiAgICAgICAgICAgIGlmIChyZXNvdXJjZS5kZXNjcmlwdGlvbiAmJiByZXNvdXJjZS5kZXNjcmlwdGlvbi5sZW5ndGggPiAwKSB7XG4gICAgICAgICAgICAgICAgaHRtbC5wdXNoKCc8YnIvPjxpPicgKyByZXNvdXJjZS5kZXNjcmlwdGlvbiArICc8L2k+Jyk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBodG1sLnB1c2goJzwvbGFiZWw+Jyk7XG4gICAgICAgICAgICBodG1sLnB1c2goJzwvbGk+Jyk7XG4gICAgICAgIH0pO1xuICAgIH1cblxuXG4gICAgcHJpdmF0ZSBzdGF0aWMgc2VsZWN0UmVzb3VyY2VzQ2IocGFyYW1zOiBhbnksIHQ6IGFueSkge1xuICAgICAgICB2YXIgcGZ4ID0gVHJ1bWJvd3lnU2VsZWN0UmVzb3VyY2VzUGx1Z2luLnBmeCA9IHQuby5wcmVmaXg7XG4gICAgICAgIC8vY29uc29sZS5sb2coJ2VkaXRvclJlc291cmNlcycsIGVkaXRvclJlc291cmNlcyk7XG5cbiAgICAgICAgdmFyIGh0bWw6IHN0cmluZ1tdID0gW107XG5cbiAgICAgICAgaHRtbC5wdXNoKCc8ZGl2IGNsYXNzPVwicmVzb3VyY2VzLXNlbGVjdCBtb2RhbC1jb250YWluZXJcIj4nKTtcbiAgICAgICAgaHRtbC5wdXNoKCc8ZGl2IGNsYXNzPVwicmVzb3VyY2VzLXNlYXJjaCBjYnItaW5wdXQtY29udHJvbFwiPicpO1xuICAgICAgICBodG1sLnB1c2goJzxsYWJlbCBmb3I9XCJ0ZXh0XCIgY2xhc3M9XCJjYnItbGFiZWxcIj4nICsgVHJ1bWJvd3lnU2VsZWN0UmVzb3VyY2VzUGx1Z2luLnRyYW5zbGF0ZSgnc2VsZWN0UmVzb3VyY2VzU2VhcmNoJykgKyc8L2xhYmVsPicpO1xuICAgICAgICBodG1sLnB1c2goJzxpbnB1dCBjbGFzcz1cImNici1pbnB1dCBjYnItaW5wdXQtZGVmYXVsdCBjYnItaW5wdXQtZW1haWxcIiB0eXBlPVwidGV4dFwiPicpO1xuICAgICAgICBodG1sLnB1c2goJzxzcGFuIGNsYXNzPVwiY2JyLWljb24taW5wdXQgY2JyLWljb24taW5wdXQtcHJpbWFyeVwiPicpO1xuICAgICAgICBodG1sLnB1c2goJzxzdmcgdmVyc2lvbj1cIjEuMVwiIHhtbG5zPVwiaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmdcIiB4bWxuczp4bGluaz1cImh0dHA6Ly93d3cudzMub3JnLzE5OTkveGxpbmtcIiB4PVwiMHB4XCIgeT1cIjBweFwiJyk7XG4gICAgICAgIGh0bWwucHVzaCgnd2lkdGg9XCIyMFwiIGhlaWdodD1cIjIwXCIgdmlld0JveD1cIjAgMCA0NTEgNDUxXCIgc3R5bGU9XCJlbmFibGUtYmFja2dyb3VuZDpuZXcgMCAwIDQ1MSA0NTE7XCIgeG1sOnNwYWNlPVwicHJlc2VydmVcIj4nKTtcbiAgICAgICAgaHRtbC5wdXNoKCc8Zz4nKTtcbiAgICAgICAgaHRtbC5wdXNoKCc8cGF0aCBkPVwiTTQ0Ny4wNSw0MjhsLTEwOS42LTEwOS42YzI5LjQtMzMuOCw0Ny4yLTc3LjksNDcuMi0xMjYuMUMzODQuNjUsODYuMiwyOTguMzUsMCwxOTIuMzUsMEM4Ni4yNSwwLDAuMDUsODYuMywwLjA1LDE5Mi4zJyk7XG4gICAgICAgIGh0bWwucHVzaCgnczg2LjMsMTkyLjMsMTkyLjMsMTkyLjNjNDguMiwwLDkyLjMtMTcuOCwxMjYuMS00Ny4yTDQyOC4wNSw0NDdjMi42LDIuNiw2LjEsNCw5LjUsNHM2LjktMS4zLDkuNS00Jyk7XG4gICAgICAgIGh0bWwucHVzaCgnQzQ1Mi4yNSw0NDEuOCw0NTIuMjUsNDMzLjIsNDQ3LjA1LDQyOHogTTI2Ljk1LDE5Mi4zYzAtOTEuMiw3NC4yLTE2NS4zLDE2NS4zLTE2NS4zYzkxLjIsMCwxNjUuMyw3NC4yLDE2NS4zLDE2NS4zJyk7XG4gICAgICAgIGh0bWwucHVzaCgncy03NC4xLDE2NS40LTE2NS4zLDE2NS40QzEwMS4xNSwzNTcuNywyNi45NSwyODMuNSwyNi45NSwxOTIuM3pcIi8+Jyk7XG4gICAgICAgIGh0bWwucHVzaCgnPC9nPicpO1xuICAgICAgICBodG1sLnB1c2goJzwvc3ZnPicpO1xuICAgICAgICBodG1sLnB1c2goJzwvc3Bhbj4nKTtcbiAgICAgICAgaHRtbC5wdXNoKCc8L2Rpdj4nKTtcbiAgICAgICAgaHRtbC5wdXNoKCc8dWwgY2xhc3M9XCJjYnIyLXRhYnNcIiByb2xlPVwidGFibGlzdFwiPicpO1xuICAgICAgICBodG1sLnB1c2goJzxsaSByb2xlPVwiYWxsXCIgY2xhc3M9XCJjYnIyLXRhYnMtaXRlbWFjdGl2ZVwiPicpO1xuICAgICAgICBodG1sLnB1c2goJyAgIDxhIGRhdGEtdHlwZT1cImFsbFwiICByb2xlPVwidGFiXCI+JyArIFRydW1ib3d5Z1NlbGVjdFJlc291cmNlc1BsdWdpbi50cmFuc2xhdGUoJ3NlbGVjdFJlc291cmNlc0FsbCcpICsgJzwvYT4nKTtcbiAgICAgICAgaHRtbC5wdXNoKCc8L2xpPicpO1xuICAgICAgICBodG1sLnB1c2goJzxsaSByb2xlPVwiZ2FsbGVyeVwiIGNsYXNzPVwiY2JyMi10YWJzLWl0ZW1cIj4nKTtcbiAgICAgICAgaHRtbC5wdXNoKCcgICA8YSBkYXRhLXR5cGU9XCJnYWxsZXJ5XCIgcm9sZT1cInRhYlwiPicgKyBUcnVtYm93eWdTZWxlY3RSZXNvdXJjZXNQbHVnaW4udHJhbnNsYXRlKCdzZWxlY3RSZXNvdXJjZXNHYWxsZXJ5JykgKyAnPC9hPicpO1xuICAgICAgICBodG1sLnB1c2goJzwvbGk+Jyk7XG4gICAgICAgIGh0bWwucHVzaCgnPGxpIHJvbGU9XCJodG1sXCIgY2xhc3M9XCJjYnIyLXRhYnMtaXRlbVwiPicpO1xuICAgICAgICBodG1sLnB1c2goJyAgIDxhIGRhdGEtdHlwZT1cImh0bWxcIiByb2xlPVwidGFiXCI+JyArIFRydW1ib3d5Z1NlbGVjdFJlc291cmNlc1BsdWdpbi50cmFuc2xhdGUoJ3NlbGVjdFJlc291cmNlc0h0bWxTaXRlJykgKyAnPC9hPicpO1xuICAgICAgICBodG1sLnB1c2goJzwvbGk+Jyk7XG4gICAgICAgIGh0bWwucHVzaCgnPGxpIHJvbGU9XCJ2aWRlb1wiIGNsYXNzPVwiY2JyMi10YWJzLWl0ZW1cIj4nKTtcbiAgICAgICAgaHRtbC5wdXNoKCcgICA8YSBkYXRhLXR5cGU9XCJ2aWRlb1wiIHJvbGU9XCJ0YWJcIj4nICsgVHJ1bWJvd3lnU2VsZWN0UmVzb3VyY2VzUGx1Z2luLnRyYW5zbGF0ZSgnc2VsZWN0UmVzb3VyY2VzVmlkZW8nKSArICc8L2E+Jyk7XG4gICAgICAgIGh0bWwucHVzaCgnPC9saT4nKTtcbiAgICAgICAgaHRtbC5wdXNoKCc8bGkgcm9sZT1cImF1ZGlvXCIgY2xhc3M9XCJjYnIyLXRhYnMtaXRlbVwiPicpO1xuICAgICAgICBodG1sLnB1c2goJyAgIDxhIGRhdGEtdHlwZT1cImF1ZGlvXCIgcm9sZT1cInRhYlwiPicgKyBUcnVtYm93eWdTZWxlY3RSZXNvdXJjZXNQbHVnaW4udHJhbnNsYXRlKCdzZWxlY3RSZXNvdXJjZXNBdWRpbycpICsgJzwvYT4nKTtcbiAgICAgICAgaHRtbC5wdXNoKCc8L2xpPicpO1xuICAgICAgICBodG1sLnB1c2goJzwvdWw+Jyk7XG4gICAgICAgIGh0bWwucHVzaCgnPGRpdiBjbGFzcz1cImNici10YWItY29udGVudFwiPicpO1xuICAgICAgICBodG1sLnB1c2goJyAgIDxkaXYgcm9sZT1cInRhYnBhbmVsXCIgY2xhc3M9XCJjYnItdGFiLXBhbmUgYWN0aXZlXCI+Jyk7XG4gICAgICAgIGh0bWwucHVzaCgnICAgPHVsIGNsYXNzPVwicmVzb3VyY2VzLWxpc3QgbGlzdC11bnN0eWxlZFwiPicpO1xuICAgICAgICBUcnVtYm93eWdTZWxlY3RSZXNvdXJjZXNQbHVnaW4ucmVuZGVyTGlzdChwZngsIGh0bWwsIFRydW1ib3d5Z1NlbGVjdFJlc291cmNlc1BsdWdpbi5lZGl0b3JSZXNvdXJjZXMpO1xuICAgICAgICBodG1sLnB1c2goJyAgIDwvdWw+Jyk7XG4gICAgICAgIGh0bWwucHVzaCgnPC9kaXY+Jyk7XG4gICAgICAgIGh0bWwucHVzaCgnPC9kaXY+Jyk7XG5cbiAgICAgICAgaHRtbC5wdXNoKCc8L2Rpdj4nKTtcblxuICAgICAgICAvL2NvbnNvbGUubG9nKCdodG1sJywgaHRtbCk7XG4gICAgICAgIHZhciAkbW9kYWwgPSBUcnVtYm93eWdTZWxlY3RSZXNvdXJjZXNQbHVnaW4uJG1vZGFsID0gdC5vcGVuTW9kYWwoVHJ1bWJvd3lnU2VsZWN0UmVzb3VyY2VzUGx1Z2luLnRyYW5zbGF0ZSgnc2VsZWN0UmVzb3VyY2VzSGVhZGVyJyksIGh0bWwuam9pbignJykpXG4gICAgICAgICAgICAub24oJ3Rid2NvbmZpcm0nLCBmdW5jdGlvbiAoKSB7XG5cbiAgICAgICAgICAgICAgICB2YXIgc2VsZWN0ZWQgPSBqUXVlcnkoJ2lucHV0OmNoZWNrZWQnLCAkbW9kYWwpO1xuICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKCdzZWxlY3RlZCcsIHNlbGVjdGVkKTtcblxuICAgICAgICAgICAgICAgIHZhciB2YWwgPSBzZWxlY3RlZC52YWwoKTtcbiAgICAgICAgICAgICAgICAvL3ZhciBpID0gcGFyc2VJbnQoc2VsZWN0ZWQuZGF0YSgnaScpLCAxMCk7XG4gICAgICAgICAgICAgICAgdmFyIHR5cGUgPSBzZWxlY3RlZC5kYXRhKCd0eXBlJyk7XG5cbiAgICAgICAgICAgICAgICB0LnJlc3RvcmVSYW5nZSgpO1xuICAgICAgICAgICAgICAgIHQuc3luY0NvZGUoKTtcblxuICAgICAgICAgICAgICAgIGlmICh2YWwpIHtcbiAgICAgICAgICAgICAgICAgICAgaWYgKHR5cGUgPT09ICdtcDQnKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICB0eXBlID0gJ3ZpZGVvJztcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICBpZiAodHlwZSA9PT0gJ21wMycgfHwgdHlwZSA9PT0gJ2FjYycpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHR5cGUgPSAnYXVkaW8nO1xuICAgICAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICAgICAgc3dpdGNoICh0eXBlKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBjYXNlICdnYWxsZXJ5JzpcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAvLyBUcnVtYm93eWdTZWxlY3RSZXNvdXJjZXNQbHVnaW4uZWRpdG9yLmluc2VydEh0bWwodCwgJzxpbWcgcmVzb3VyY2UtaW4tcmVzb3VyY2UtcmVuZGVyICcgK1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vICAgICAnZGF0YS1pdGVtLWlkPVwiJyArIHZhbCArICdcIiBkYXRhLXR5cGU9XCJnYWxsZXJ5XCIgZGF0YS1leHQ9XCInICsgdHlwZSArICdcIiBkYXRhLWdhbGxlcnktc3JjPVwiJyArIHZhbCArICdcIicgK1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vICAgICAnc3JjPVwiL3RoZW1lcy9kZWZhdWx0L2Fzc2V0cy9pbWcvaW5saW5lLWdhbGxlcnkucG5nXCIgLz4nKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBUcnVtYm93eWdTZWxlY3RSZXNvdXJjZXNQbHVnaW4uZWRpdG9yLmluc2VydEh0bWwodCwgJzxpZnJhbWUgcmVzb3VyY2UtaW4tcmVzb3VyY2UtaWZyYW1lPVwiXCIgYWxsb3dmdWxsc2NyZWVuIHdpZHRoPVwiMTAwJVwiIGhlaWdodD1cIjY0MHB4XCIgZnJhbWVib3JkZXI9XCIwXCIgJyArXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICdzcmM9XCIvbm9kZV9tb2R1bGVzL2NvbGxhYm9yYXRvci1nYWxsZXJ5L2Rpc3QvaW5kZXguaHRtbD9pZD0nICsgdmFsICsgJ1wiIGRhdGEtaXRlbS1pZD1cIicgKyB2YWwgKyAnXCIgc2Nyb2xsaW5nPVwibm9cIiBtYXJnaW5oZWlnaHQ9XCIwXCIgJyArXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICdjbGFzcz1cIm5vLWJvcmRlciBlbWJlZC1yZXNwb25zaXZlLWl0ZW1cIj48L2lmcmFtZT4nKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgICAgICAgICAgICAgIGNhc2UgJ3ZpZGVvJzpcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAvLyBUcnVtYm93eWdTZWxlY3RSZXNvdXJjZXNQbHVnaW4uZWRpdG9yLmluc2VydEh0bWwodCwgJzxpbWcgcmVzb3VyY2UtaW4tcmVzb3VyY2UtcmVuZGVyICcgK1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vICAgICAnZGF0YS1pdGVtLWlkPVwiJyArIHZhbCArICdcIiBkYXRhLXR5cGU9XCJ2aWRlb1wiIGRhdGEtZXh0PVwiJyArIHR5cGUgKyAnXCIgZGF0YS12aWRlby1zcmM9XCInICsgdmFsICsgJ1wiJyArXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8gICAgICdzcmM9XCIvdGhlbWVzL2RlZmF1bHQvYXNzZXRzL2ltZy9pbmxpbmUtdmlkZW8ucG5nXCIgLz4nKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBUcnVtYm93eWdTZWxlY3RSZXNvdXJjZXNQbHVnaW4uZWRpdG9yLmluc2VydEh0bWwodCwgJzxpZnJhbWUgcmVzb3VyY2UtaW4tcmVzb3VyY2UtaWZyYW1lPVwiXCIgYWxsb3dmdWxsc2NyZWVuIHdpZHRoPVwiMTAwJVwiIGhlaWdodD1cIjQ4MHB4XCIgZnJhbWVib3JkZXI9XCIwXCIgJyArXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICdzcmM9XCIvbm9kZV9tb2R1bGVzL2NvbGxhYm9yYXRvci12aWRlby1wbGF5ZXIvZGlzdC9pbmRleC5odG1sP2lkPScgKyB2YWwgKyAnXCIgZGF0YS1pdGVtLWlkPVwiJyArIHZhbCArICdcIiBzY3JvbGxpbmc9XCJub1wiIG1hcmdpbmhlaWdodD1cIjBcIiAnICtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJ2NsYXNzPVwibm8tYm9yZGVyIGVtYmVkLXJlc3BvbnNpdmUtaXRlbVwiPjwvaWZyYW1lPicpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgICAgICAgICAgICAgY2FzZSAnYXVkaW8nOlxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vIFRydW1ib3d5Z1NlbGVjdFJlc291cmNlc1BsdWdpbi5lZGl0b3IuaW5zZXJ0SHRtbCh0LCAnPGltZyByZXNvdXJjZS1pbi1yZXNvdXJjZS1yZW5kZXIgJyArXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8gICAgICdkYXRhLWl0ZW0taWQ9XCInICsgdmFsICsgJ1wiIGRhdGEtdHlwZT1cImF1ZGlvXCIgZGF0YS1leHQ9XCInICsgdHlwZSArICdcIiBkYXRhLXNyYz1cIicgKyB2YWwgKyAnXCInICtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAvLyAgICAgJ3NyYz1cIi90aGVtZXMvZGVmYXVsdC9hc3NldHMvaW1nL2lubGluZS1hdWRpby5wbmdcIiAvPicpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIFRydW1ib3d5Z1NlbGVjdFJlc291cmNlc1BsdWdpbi5lZGl0b3IuaW5zZXJ0SHRtbCh0LCAnPGlmcmFtZSByZXNvdXJjZS1pbi1yZXNvdXJjZS1pZnJhbWU9XCJcIiBhbGxvd2Z1bGxzY3JlZW4gd2lkdGg9XCIxMDAlXCIgaGVpZ2h0PVwiNjVweFwiIGZyYW1lYm9yZGVyPVwiMFwiICcgK1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAnc3JjPVwiL25vZGVfbW9kdWxlcy9jb2xsYWJvcmF0b3ItYXVkaW8tcGxheWVyL2Rpc3QvaW5kZXguaHRtbD9pZD0nICsgdmFsICsgJ1wiIGRhdGEtaXRlbS1pZD1cIicgKyB2YWwgKyAnXCIgc2Nyb2xsaW5nPVwibm9cIiBtYXJnaW5oZWlnaHQ9XCIwXCIgJyArXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICdjbGFzcz1cIm5vLWJvcmRlciBlbWJlZC1yZXNwb25zaXZlLWl0ZW1cIj48L2lmcmFtZT4nKTtcblxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgICAgICAgICAgICAgY2FzZSAnaHRtbCc6XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8gVHJ1bWJvd3lnU2VsZWN0UmVzb3VyY2VzUGx1Z2luLmVkaXRvci5pbnNlcnRIdG1sKHQsICc8aW1nIHJlc291cmNlLWluLXJlc291cmNlLXJlbmRlciAnICtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAvLyAgICAgJ2RhdGEtaXRlbS1pZD1cIicgKyB2YWwgKyAnXCIgZGF0YS10eXBlPVwiaHRtbFwiIGRhdGEtZXh0PVwiJyArIHR5cGUgKyAnXCIgZGF0YS1zcmM9XCInICsgdmFsICsgJ1wiJyArXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8gICAgICdzcmM9XCIvdGhlbWVzL2RlZmF1bHQvYXNzZXRzL2ltZy9pbmxpbmUtcmVzb3VyY2UucG5nXCIgLz4nKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBUcnVtYm93eWdTZWxlY3RSZXNvdXJjZXNQbHVnaW4uZWRpdG9yLmluc2VydEh0bWwodCwgJzxpZnJhbWUgcmVzb3VyY2UtaW4tcmVzb3VyY2UtaWZyYW1lPVwiXCIgYWxsb3dmdWxsc2NyZWVuIHdpZHRoPVwiMTAwJVwiIGhlaWdodD1cIjY0MHB4XCIgZnJhbWVib3JkZXI9XCIwXCIgJyArXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICdzcmM9XCIvbm9kZV9tb2R1bGVzL2NvbGxhYm9yYXRvci1odG1sLXBsYXllci9kaXN0L2luZGV4Lmh0bWw/aWQ9JyArIHZhbCArICdcIiBzY3JvbGxpbmc9XCJub1wiIG1hcmdpbmhlaWdodD1cIjBcIiBkYXRhLWl0ZW0taWQ9XCInICsgdmFsICsgJ1wiICcgK1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAnY2xhc3M9XCJuby1ib3JkZXIgZW1iZWQtcmVzcG9uc2l2ZS1pdGVtXCI+PC9pZnJhbWU+Jyk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICBzZXRUaW1lb3V0KGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgICAgICAgICAgdC5jbG9zZU1vZGFsKCk7XG4gICAgICAgICAgICAgICAgfSwgMjUwKTtcbiAgICAgICAgICAgIH0pXG4gICAgICAgICAgICAub24oJ3Rid2NhbmNlbCcsIGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgICAgICB0LnJlc3RvcmVSYW5nZSgpO1xuICAgICAgICAgICAgICAgIHQuY2xvc2VNb2RhbCgpO1xuICAgICAgICAgICAgfSk7XG5cbiAgICAgICAgalF1ZXJ5KCcuY2JyMi10YWJzIGEnLCAkbW9kYWwpLm9mZignY2xpY2snKS5vbignY2xpY2snLCBmdW5jdGlvbiAoZTogYW55KSB7XG4gICAgICAgICAgICBlLnByZXZlbnREZWZhdWx0KCk7XG5cbiAgICAgICAgICAgIGpRdWVyeSgnLmNicjItdGFicy1pdGVtJywgJG1vZGFsKS5yZW1vdmVDbGFzcygnY2JyLXRhYnMtYWN0aXZlJyk7XG4gICAgICAgICAgICBqUXVlcnkodGhpcykucGFyZW50KCkuYWRkQ2xhc3MoJ2Nici10YWJzLWFjdGl2ZScpO1xuXG4gICAgICAgICAgICBUcnVtYm93eWdTZWxlY3RSZXNvdXJjZXNQbHVnaW4ub25TZWFyY2guZW1pdCh7XG4gICAgICAgICAgICAgICAgdHlwZTogalF1ZXJ5KHRoaXMpLmF0dHIoJ2RhdGEtdHlwZScpIHx8ICdhbGwnLFxuICAgICAgICAgICAgICAgIHRpdGxlOiBqUXVlcnkoJy5jYnItaW5wdXQnLCAkbW9kYWwpLnZhbCgpXG4gICAgICAgICAgICB9KTtcbiAgICAgICAgfSk7XG5cbiAgICAgICAgalF1ZXJ5KCcuY2JyLWljb24taW5wdXQnLCAkbW9kYWwpLm9mZignY2xpY2snKS5vbignY2xpY2snLCBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICBUcnVtYm93eWdTZWxlY3RSZXNvdXJjZXNQbHVnaW4ub25TZWFyY2guZW1pdCh7XG4gICAgICAgICAgICAgICAgdHlwZTogalF1ZXJ5KHRoaXMpLmF0dHIoJ2RhdGEtdHlwZScpIHx8ICdhbGwnLFxuICAgICAgICAgICAgICAgIHRpdGxlOiBqUXVlcnkoJy5jYnItaW5wdXQnLCAkbW9kYWwpLnZhbCgpXG4gICAgICAgICAgICB9KTtcbiAgICAgICAgfSk7XG4gICAgfVxuXG4gICAgcHVibGljIHN0YXRpYyB1cGRhdGVSZXNvdXJjZXMoZWRpdG9yUmVzb3VyY2VzOiBhbnlbXSkge1xuICAgICAgICBUcnVtYm93eWdTZWxlY3RSZXNvdXJjZXNQbHVnaW4uZWRpdG9yUmVzb3VyY2VzID0gZWRpdG9yUmVzb3VyY2VzO1xuICAgICAgICAvL1xuICAgICAgICBqUXVlcnkoJy5yZXNvdXJjZXMtbGlzdCcsIFRydW1ib3d5Z1NlbGVjdFJlc291cmNlc1BsdWdpbi4kbW9kYWwpLmVtcHR5KCk7XG4gICAgICAgIHZhciBsaHRtbDogc3RyaW5nW10gPSBbXTtcbiAgICAgICAgVHJ1bWJvd3lnU2VsZWN0UmVzb3VyY2VzUGx1Z2luLnJlbmRlckxpc3QoVHJ1bWJvd3lnU2VsZWN0UmVzb3VyY2VzUGx1Z2luLnBmeCwgbGh0bWwsIGVkaXRvclJlc291cmNlcyk7XG4gICAgICAgIGpRdWVyeSgnLnJlc291cmNlcy1saXN0JywgVHJ1bWJvd3lnU2VsZWN0UmVzb3VyY2VzUGx1Z2luLiRtb2RhbCkuYXBwZW5kKGxodG1sLmpvaW4oJycpKTtcbiAgICB9XG59XG4iXX0=